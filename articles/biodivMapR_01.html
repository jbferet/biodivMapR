<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Sentinel-2 data and validation • biodivMapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get Sentinel-2 data and validation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivMapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biodivMapR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/biodivMapR_01.html">Get Sentinel-2 data and validation</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_02.html">Produce features from original raster</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_03.html">Produce diversity maps from a set of features</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_04.html">Validation with ground information</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbferet/biodivMapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get Sentinel-2 data and validation</h1>
                        <h4 data-toc-skip class="author">Jean-Baptiste
Féret, Florian de Boissieu</h4>
            
            <h4 data-toc-skip class="date">2025-01-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbferet/biodivMapR/blob/master/vignettes/biodivMapR_01.Rmd" class="external-link"><code>vignettes/biodivMapR_01.Rmd</code></a></small>
      <div class="hidden name"><code>biodivMapR_01.Rmd</code></div>

    </div>

    
    
<p><code>biodivMapR</code> aims at producing spectral diversity maps
based on multidimensional raster data. While its application is
technically not limited to optical imagery, users experimenting with
other types of remote sensing data are expected to make sure that the
input information used to produce remotely sensed diversity maps are
actually relevant to describe vegetation biodiversity as intended in
<code>biodivMapR</code>.</p>
<div class="section level2">
<h2 id="data-requirements">Data requirements<a class="anchor" aria-label="anchor" href="#data-requirements"></a>
</h2>
<p><code>biodivMapR</code> requires raster data as input. Raster data
are handled with the R package <a href="https://rspatial.github.io/terra/reference/terra-package.html" class="external-link"><code>terra</code></a>.
Data format should then be compliant with the drivers available with
this package.</p>
<p>If using multispectral/hyperspectral optical data, <strong>the
central wavelength should be properly identified for each spectral band
provided</strong>. Central wavelength is required for the computation of
spectral indices or the application of continuum removal.</p>
</div>
<div class="section level2">
<h2 id="download-sentinel-2-image-sample">Download Sentinel-2 image sample<a class="anchor" aria-label="anchor" href="#download-sentinel-2-image-sample"></a>
</h2>
<p>The S2 subset used for this tutorial corresponds to a forested area
in Cameroon. We previously identified a S2 acquisition with minimum
cloud cover. Visualization can be done with the <a href="https://browser.dataspace.copernicus.eu/" class="external-link">Copenicus
Browser</a></p>
<p>Once a correct acquisition identified, Sentinel-2 imagery is obtained
with the R package <a href="https://jbferet.gitlab.io/preprocs2/" class="external-link"><code>preprocS2</code></a>.</p>
<p>The chunk of code below downloads Sentinel-2 products corresponding
to a bounding box from the STAC catalog provided by Microsoft Planetary
Computer.</p>
<ul>
<li>
<code>Refl_L2A</code> is the L-2A reflectance for the bounding
box</li>
<li>
<code>provider_mask</code> is the corresponding SCL (scene
classification layer)</li>
<li>
<code>Binary_mask</code> is a binary vegetation mask extracted from
the SCL</li>
<li>
<code>vegetation_mask</code> is an updated binary vegetation mask
after application of NDVI and radiometric thresholds to remove
non-vegetated, shaded and hazy pixels (very basic filtering)</li>
</ul>
<p>Additionally, The rasters corresponding to the geometry of
acquisition can be downloaded from the <a href="https://dataspace.copernicus.eu/analyse/apis" class="external-link">CDSE</a>, if valid
authentication is provided and <code>geomAcq = T</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load useful libraries </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">preprocS2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="co"># 1- define input &amp; output directories</span></span>
<span><span class="va">output_dir_s2</span> <span class="op">&lt;-</span> <span class="st">'./S2_data2'</span></span>
<span><span class="va">datetime</span> <span class="op">&lt;-</span> <span class="st">'2018-12-25'</span></span>
<span><span class="va">siteName</span> <span class="op">&lt;-</span> <span class="st">'S2_subset_Cameroon'</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'xmin'</span> <span class="op">=</span> <span class="fl">357001</span>, <span class="st">'ymin'</span> <span class="op">=</span> <span class="fl">341701</span>, </span>
<span>                            <span class="st">'xmax'</span> <span class="op">=</span> <span class="fl">366730</span>, <span class="st">'ymax'</span> <span class="op">=</span> <span class="fl">351236</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">32633</span></span>
<span></span>
<span><span class="co"># 2- get tiling grid kml from https://sentiwiki.copernicus.eu/web/s2-products</span></span>
<span><span class="va">path_S2tilinggrid</span> <span class="op">&lt;-</span> <span class="st">'Sentinel-2_tiling_grid.kml'</span></span>
<span></span>
<span><span class="co"># 3- get S2 acquisition and geometry of acquisition for study area</span></span>
<span><span class="co"># https://shapps.dataspace.copernicus.eu/dashboard/#/account/settings</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"sh-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"</span></span>
<span><span class="va">secret</span> <span class="op">&lt;-</span> <span class="st">"XXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span></span>
<span></span>
<span><span class="co"># tip to save credential on your computer: run the following command : </span></span>
<span><span class="co"># &gt; file.edit("~/.Renviron")</span></span>
<span><span class="co"># add ID and password for CDSE as well as CURL_SSL_BACKEND using this template</span></span>
<span><span class="co"># &gt; CDSE_ID="sh-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"</span></span>
<span><span class="co"># &gt; CDSE_SECRET="XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span></span>
<span><span class="co"># &gt; CURL_SSL_BACKEND="openssl"</span></span>
<span><span class="co"># save .Renviron file and restart R session then load your credential this way: </span></span>
<span><span class="co"># &gt; id &lt;- Sys.getenv("CDSE_ID")</span></span>
<span><span class="co"># &gt; secret &lt;- Sys.getenv("CDSE_SECRET")</span></span>
<span><span class="va">authentication</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'id'</span> <span class="op">=</span> <span class="va">id</span>, <span class="st">'pwd'</span> <span class="op">=</span> <span class="va">secret</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3- get S2 acquisition for study area</span></span>
<span><span class="va">list_files</span> <span class="op">&lt;-</span> <span class="fu">preprocS2</span><span class="fu">::</span><span class="fu">get_s2_raster</span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, geomAcq <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                       authentication <span class="op">=</span> <span class="va">authentication</span>, </span>
<span>                                       path_S2tilinggrid <span class="op">=</span> <span class="va">path_S2tilinggrid</span>, </span>
<span>                                       datetime <span class="op">=</span> <span class="va">datetime</span>, </span>
<span>                                       output_dir <span class="op">=</span> <span class="va">output_dir_s2</span>, </span>
<span>                                       siteName <span class="op">=</span> <span class="va">siteName</span><span class="op">)</span></span>
<span><span class="co"># Sentinel-2 L2A reflectance</span></span>
<span><span class="va">Refl_L2A</span> <span class="op">&lt;-</span> <span class="va">list_files</span><span class="op">$</span><span class="va">Refl_L2A</span></span>
<span><span class="co"># Sentinel-2 binary mask identifying vegetation, discarding clouds &amp; shadows</span></span>
<span><span class="va">vegetation_mask</span> <span class="op">&lt;-</span> <span class="va">list_files</span><span class="op">$</span><span class="va">vegetation_mask</span></span>
<span><span class="co"># Sentinel-2 mask from provider ( = SCL from ESA products)</span></span>
<span><span class="va">SCL</span> <span class="op">&lt;-</span> <span class="va">list_files</span><span class="op">$</span><span class="va">provider_mask</span></span>
<span><span class="co"># Sentinel-2 geometry of acquisition (if requested from CDSE)</span></span>
<span><span class="va">geometryAcquisition</span> <span class="op">&lt;-</span> <span class="va">list_files</span><span class="op">$</span><span class="va">geometryAcquisition</span></span></code></pre></div>
<p>
</p>
<p><img src="../reference/figures/SiteRGB.png" width="100%" height="100%" class="center"></p>

<p>Once the image is downloaded, it can be processed with
<code>biodivMapR</code>.</p>
<div class="section level3">
<h3 id="download-vector-files-used-for-validation">Download vector files used for ‘validation’<a class="anchor" aria-label="anchor" href="#download-vector-files-used-for-validation"></a>
</h3>
<p>A set of vector files is downloaded here, corresponding to circular
plots identified in the raster. It will be used in the final step of the
tutorial (<a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_08.html" target="_blank" class="external-link"><strong>How to perform validation?</strong></a>.).</p>
<p>The following code allows downloading the zipfile containing the
vector data, and unzipping it in the same directory as the one including
the raster data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/zip" class="external-link">zip</a></span><span class="op">)</span></span>
<span><span class="co"># name zip file including plots located on the tile</span></span>
<span><span class="va">output_dir_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir_s2</span>, <span class="st">'GroudData'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">output_dir_val</span>, showWarnings <span class="op">=</span> <span class="cn">F</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">destzip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir_val</span>,<span class="st">'S2A_T33NUD_Plots.zip'</span><span class="op">)</span></span>
<span><span class="co"># url for the zip file</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">'https://gitlab.com/jbferet/myshareddata/-/raw/master/biodivMapR_S2_Sample/VECTOR/S2A_T33NUD_Plots.zip'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">destzip</span><span class="op">)</span></span>
<span><span class="va">destunz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>,<span class="st">'S2A_T33NUD_Plots'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-lib.github.io/zip/reference/unzip.html" class="external-link">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">destzip</span>, exdir <span class="op">=</span> <span class="va">destunz</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">destzip</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><br><br></p>
<p>Now that the necessary data is downloaded, we can start the <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_02.html" target="_blank" class="external-link">tutorial</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean-Baptiste Feret, Florian de Boissieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
