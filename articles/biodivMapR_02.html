<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Set parameters for biodivMapR • biodivMapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Set parameters for biodivMapR">
<meta property="og:description" content="biodivMapR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivMapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biodivMapR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/biodivMapR_01.html">Prepare your data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_02.html">Set parameters for biodivMapR</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_03.html">Perform spatial &amp; spectral filtering</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_04.html">PCA &amp; Dimensionality reduction</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_05.html">Spectral species mapping</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_06.html">alpha and beta diversity maps</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_07.html">Functional Diversity</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_08.html">How to perform validation?</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_09.html">Compute diversity from user-defined set of layers</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_10.html">Map diversity from Lautaret HS image</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_11.html">PROGYSAT#1: download S2 data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_12.html">PROGYSAT#2: Run biodivMapR on S2 reflectance data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_13.html">PROGYSAT#3: Run biodivMapR on selected spectral indices</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_14.html">COPERNICUS &amp; biodiv #1: set working environment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbferet/biodivMapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Set parameters for biodivMapR</h1>
                        <h4 data-toc-skip class="author">Jean-Baptiste
Féret, Florian de Boissieu</h4>
            
            <h4 data-toc-skip class="date">2023-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbferet/biodivMapR/blob/HEAD/vignettes/biodivMapR_02.Rmd" class="external-link"><code>vignettes/biodivMapR_02.Rmd</code></a></small>
      <div class="hidden name"><code>biodivMapR_02.Rmd</code></div>

    </div>

    
    
<p>The image is <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_01.html" target="_blank" class="external-link">ready to process</a>, parameter setting for
<code>biodivMapR</code> can start.</p>
<div class="section level3">
<h3 id="image-to-be-processed">Image to be processed<a class="anchor" aria-label="anchor" href="#image-to-be-processed"></a>
</h3>
<p>First, let’s define the (absolute or relative) path to the image file
to be processed.</p>
<p>Here we are using the image downloaded during the first step of the
tutorial. The raster file systematically needs to pair with a
<strong>.hdr</strong> file which will be automatically identified.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Input_Image_File</span> <span class="op">&lt;-</span> <span class="va">destfile</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mask-corresponding-to-the-image">Mask corresponding to the image<a class="anchor" aria-label="anchor" href="#mask-corresponding-to-the-image"></a>
</h3>
<p>It is possible to provide a mask file at this first stage of the
process, in order take advantage of cloud detection or any other
preprocessing step, and to target specific/valid areas.</p>
<p>This mask file is introduced the same way as the image, by providing
the absolute or relative path to the raster file.</p>
<p>The mask is expected to be the same spatial dimensions and extent as
the raster file to process (columns and lines)</p>
<p>Expected values in the mask:</p>
<ul>
<li><p>0 = pixel is masked</p></li>
<li><p>1 = pixel is selected</p></li>
</ul>
<p>If possible, the mask should be written in ENVI HDR format, with 1
band and values coded in integer 8bits.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set to FALSE if no mask available</span></span>
<span><span class="va">Input_Mask_File</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="definition-of-an-output-directory">Definition of an output directory<a class="anchor" aria-label="anchor" href="#definition-of-an-output-directory"></a>
</h3>
<p>Various files will be computed and written on the disk during the
process.</p>
<p>These files will be written in a directory structure created within a
main output directory</p>
<p>A sub directory named after the name of the image processed is
automatically created in this main output directory, in order to
facilitate identification of the results corresponding to a given
image.</p>
<p>If the same image is processed with different parameter settings,
some files may be overwritten.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Output_Dir</span> <span class="op">&lt;-</span> <span class="st">'../RESULTS'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="radiometric-filterings">Radiometric filterings<a class="anchor" aria-label="anchor" href="#radiometric-filterings"></a>
</h3>
<p>If no mask file is available with the image to process, it is
possible to perform basic radiometric filterings:</p>
<ul>
<li><p><strong>Elimination of non vegetated pixels</strong>: the mask
can be updated based on NDVI thresholding. Pixels with NDVI lower than
this threshold are masked.</p></li>
<li><p><strong>Elimination of residual clouds</strong>: : the mask can
be updated based on NDVI thresholding. Pixels with reflectance in blue
domain higher than this threshold are masked</p></li>
<li><p><strong>Elimination of shaded areas</strong>: the mask can be
updated based on NIR thresholding. Pixels with reflectance in NIR domain
lower than this threshold are masked.</p></li>
</ul>
<p>__These radiometric filters are very basic filters and should not
replace algorthms dedicated to the detection of
cloud/shade/non-vegetated pixels.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_Thresh</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">Blue_Thresh</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">NIR_Thresh</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="normalization-of-reflectance-data">Normalization of reflectance data<a class="anchor" aria-label="anchor" href="#normalization-of-reflectance-data"></a>
</h3>
<p><strong>Continuum Removal</strong>, a normalization procedure, is
available when working with reflectance data. This procedure eliminates
multiplicative effects, and proved to be relatively efficient in
decreasing the effect of changes in illumination within individual tree
crowns, when using high spatial resolution imaging spectroscopy over
tropical forests.</p>
<p><strong>Continuum Removal</strong> is recommended when processing
high spatial resolution (spatial resolutionc <span class="math inline">\(\leq\)</span> 10 m) multi and hyperspectral
data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Continuum_Removal</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transformation-of-reflectance-and-dimensionality-reduction">Transformation of reflectance and dimensionality reduction<a class="anchor" aria-label="anchor" href="#transformation-of-reflectance-and-dimensionality-reduction"></a>
</h3>
<p>Once normalization is performed, the next step in
<code>biodivMapR</code> consists in transformation of the data using one
of the following techniques:</p>
<ul>
<li><p><code>PCA</code>: Principal component analysis (no rescaling of
the data, computation from covariance matrix)</p></li>
<li><p><code>SPCA</code>: Standardized Principal component analysis (no
rescaling of the data, computation from correlation matrix)</p></li>
<li><p><code>MNF</code>: minimum noise fraction (appropriate for high
dimensionality data such as imaging spectroscopy)</p></li>
</ul>
<p>These transformations will be followed by component selection in
order to perform dimensionality reduction.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TypePCA</span> <span class="op">&lt;-</span> <span class="st">'SPCA'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtering-outliers-in-pca">Filtering outliers in PCA<a class="anchor" aria-label="anchor" href="#filtering-outliers-in-pca"></a>
</h3>
<p>An additional filtering step can be performed, based on the detection
of outliers in components of the PCA. This strategy is computationally
more demanding and significantly longer. However, this outlier detection
may be useful to mask pixels including residual effect of atmosphere, or
outliers which may not be relevant to include in the process of
computation of spectral variation.</p>
<p>This PCA filtering can be performed by setting a unique parameter,
<code>FilterPCA</code>, to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PCA FILTERING:        Set to TRUE if you want second filtering based on PCA outliers to be processed.</span></span>
<span><span class="co"># Slower process</span></span>
<span><span class="co"># Automatically set to FALSE if TypePCA     = 'MNF'</span></span>
<span><span class="va">FilterPCA</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="definition-of-window-size-for-computation-of-spectral-diversity">Definition of window size for computation of spectral diversity<a class="anchor" aria-label="anchor" href="#definition-of-window-size-for-computation-of-spectral-diversity"></a>
</h3>
<p><code>biodivMapR</code> computes spectral diversity over a set of
pixels. The number of pixels included for each spectral diversity data
point is defined by a window size. The window size defines the spatial
resolution of all diversity maps.</p>
<p>The length of the side of the window is provided as input parameter:
if <code>window_size=10</code>, then the pixels in the spectral
diversity maps will correspond to a 10x10 pixels windows in the original
image.</p>
<p>Both image spatial resolution and type of ecosystem under study
should be taken into account when defining the window size: in forested
ecosystems, window size should be large enough to include groups of
individuals.</p>
<p>In forested ecosystems, window size between 0.25 and 4 ha usually
match with ground data and correspond to a fair compromise. However,
this would need to be adapted to specific situations.</p>
<p>If the value of window_size is too low, this will result in low
number of pixels per spatial unit, hence limited range of variation of
diversity in the image.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">window_size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimization-of-computational-resource">Optimization of computational resource<a class="anchor" aria-label="anchor" href="#optimization-of-computational-resource"></a>
</h3>
<p>The computational resource can be adjusted:</p>
<ul>
<li><p><code>nbCPU</code> corresponds to the number of processing units
to be used during steps of the computation which are parallelized. Make
sure you do not ask for more than what your computer can
provide.</p></li>
<li><p><code>MaxRAM</code> corresponds to the maximum size of file chunk
of loaded in the RAM when processing the image.
<strong>WARNING</strong>: this does not corresponds to the maximum
amount of RAM needed for data processing. Once a chunk of file is
written, its processing may require several time this amount of RAM to
perfom different processing steps. <code>MaxRAM &lt;- 0.5</code> is
reasonable when processing a 2Gb raster on a personal computer with 16Gb
RAM. However, larger values of <code>MaxRAM</code> may rapidly require
larger amount of RAM.</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nbCPU</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">MaxRAM</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="number-of-spectral-species">Number of spectral species<a class="anchor" aria-label="anchor" href="#number-of-spectral-species"></a>
</h3>
<p>The main spectral diversity metrics computed by
<code>biodivMapR</code> are based on a clustering of normalized &amp;
dimensionality reduced image. Following this clustering, a cluster ID is
assigned to each pixel, corresponding to the <strong>‘spectral
species’</strong> defined in the original publication.</p>
<p>The number of clusters is defined by the value of
<code>nbclusters</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nbclusters</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></code></pre></div>
<p><br><br></p>
<p>Once parameterization has been set, the image processing can start,
first with an optional <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_03.html" target="_blank" class="external-link">radiometric filtering</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean-Baptiste Feret, Florian de Boissieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
