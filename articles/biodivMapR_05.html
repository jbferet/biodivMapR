<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>`biodivMapR` applied with biophysical trait estimation with `prosail` • biodivMapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="`biodivMapR` applied with biophysical trait estimation with `prosail`">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivMapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biodivMapR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/biodivMapR_01.html">get Sentinel-2 data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_02.html">produce features from a raster</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_03.html">produce diversity maps from a set of features</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_04.html">validation / comparison with ground observation / intercomparison</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_05.html">`biodivMapR` applied with biophysical trait estimation with `prosail`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbferet/biodivMapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<code>biodivMapR</code> applied with biophysical
trait estimation with <code>prosail</code>
</h1>
                        <h4 data-toc-skip class="author">Jean-Baptiste
Féret, Florian de Boissieu</h4>
            
            <h4 data-toc-skip class="date">2026-02-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbferet/biodivMapR/blob/master/vignettes/biodivMapR_05.Rmd" class="external-link"><code>vignettes/biodivMapR_05.Rmd</code></a></small>
      <div class="hidden name"><code>biodivMapR_05.Rmd</code></div>

    </div>

    
    
<p>This tutorial will guide you through the application of
<code>prosail</code> in order to produce biophysical properties from
hybrid inversion, then used to estimate spectral diversity with
<code>biodivMapR</code>.</p>
<p>This is the tutorial associated to the book chapter <a href="https://doi.org/10.1007/978-3-031-99665-8_7" class="external-link"><code>A Plant Trait-Based Approach to Map Forest Biodiversity Using Imaging Spectroscopy and Physical Modeling</code></a>,
which is part of the book <a href="https://link.springer.com/book/10.1007/978-3-031-99665-8" class="external-link"><code>R Coding for Ecology</code></a>,
in the <strong>Use R!</strong> book series (Springer).</p>
<p><strong>Warning</strong>: this tutorial is appropriate with prosail
v3.0.0 and later. please install the ‘dev_joss’ branch if the master
branch is &lt;3.0.0</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_gitlab</span><span class="op">(</span><span class="st">'jbferet/prosail@dev_joss'</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="download-imaging-spectroscopy-data-required-for-the-tutorial">download imaging spectroscopy data required for the tutorial<a class="anchor" aria-label="anchor" href="#download-imaging-spectroscopy-data-required-for-the-tutorial"></a>
</h2>
<p>The image can be downloaded from <a href="https://doi.org/10.57745/SDPRYY" class="external-link">this webpage</a>. Three files are
available on the webpage:</p>
<ul>
<li><p><code>Readme_FAbas_HS_mosaic-2.pdf</code></p></li>
<li><p><code>Fabas_HS_mosaic.hdr</code>: header file for the image data,
contains all metadata such as central wavelengths of the different
bands, image size, projection…</p></li>
<li><p><code>Fabas_HS_mosaic.tif</code>: the binary image. This is a
surface reflectance image, which is geometrically and atmospherically
corrected. Image spatial resolution is 4m. a multiplying factor of 10000
was applied on reflectance (10000 = 100% reflectance).</p></li>
</ul>
<p>The data should be placed in a directory defined as
<code>data_dir</code> in the next code chunk.</p>
<p>Figure 1 shows an RGB representation of the imaging spectroscopy data
acquired over the Fabas forest.</p>
<p><img src="https://gitlab.com/jbferet/myshareddata/-/raw/master/biodivMapR_vignette_illustrations/05_rgb_hyspex.png" class="r-plt" alt="" width="100%"></p>
<center>
<p>Fig. 1. color composition of Hyspex imaging spectroscopy
acquisition.</p>
R = 661 nm, G = 559 nm, B = 458 nm.
</center>
<p>
 
</p>
</div>
<div class="section level2">
<h2 id="define-input-output-directories">define input / output directories<a class="anchor" aria-label="anchor" href="#define-input-output-directories"></a>
</h2>
<p>The input data directory is defined, as well as the directory where
vegetation biophysical parameters obtained from <code>prosail</code>
hybrid inversion. This tutorial uses functions performing raster tiling
when processing <code>prosail</code> hybrid inversion, hence the
definition of a subdirectory named <code>tiles</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># clean workspace</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/rstudioapi/reference/isAvailable.html" class="external-link">isAvailable</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/rstudioapi/reference/rstudio-editors.html" class="external-link">getSourceEditorContext</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gitlab.com/jbferet/prosail" class="external-link">prosail</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1.1- define input &amp; output directories</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">'./01_DATA/fabas'</span></span>
<span><span class="va">prosail_dir</span> <span class="op">&lt;-</span> <span class="st">'./03_RESULTS/fabas/prosail_inversion'</span></span>
<span><span class="va">prosail_tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">prosail_dir</span>, <span class="st">'tiles'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">prosail_tiles</span>, showWarnings <span class="op">=</span> <span class="cn">F</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-imaging-spectroscopy-data-for-processing-spectralspatial-masking">prepare imaging spectroscopy data for processing: spectral/spatial
masking<a class="anchor" aria-label="anchor" href="#prepare-imaging-spectroscopy-data-for-processing-spectralspatial-masking"></a>
</h2>
<div class="section level3">
<h3 id="get-metadata-and-additional-information">get metadata and additional information<a class="anchor" aria-label="anchor" href="#get-metadata-and-additional-information"></a>
</h3>
<p>Identify the imaging spectroscopy raster, and get metadata from the
header file. The central wavelength and full width at half maximum
(FHWM) are needed to produce a spectral response function which will
then be needed to simulate surface reflectance with sensor response.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1.2- define input &amp; output directories</span></span>
<span><span class="va">input_raster_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>,<span class="st">'Fabas_HS_mosaic.tif'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get information on wavelength and fwhm from header</span></span>
<span><span class="va">hdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/preprocS2/man/read_envi_header.html" class="external-link">read_envi_header</a></span><span class="op">(</span>hdr_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/preprocS2/man/get_HDR_name.html" class="external-link">get_hdr_name</a></span><span class="op">(</span>image_path <span class="op">=</span> <span class="va">input_raster_path</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sensor_bands</span> <span class="op">&lt;-</span> <span class="va">hdr</span><span class="op">$</span><span class="va">wavelength</span></span>
<span><span class="va">sensor_fwhm</span> <span class="op">&lt;-</span> <span class="va">hdr</span><span class="op">$</span><span class="va">fwhm</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filter-out-shaded-non-vegetated-and-hazy-pixels-">filter out shaded, non vegetated, and hazy pixels.<a class="anchor" aria-label="anchor" href="#filter-out-shaded-non-vegetated-and-hazy-pixels-"></a>
</h3>
<p>A basic filtering process can be applied in order to mask irrelevant
pixels (no vegetation) and pixels with poor quality (hazy/cloudy or
shaded areas). The function <code>radiometric_filtering</code>
implemented in the package <a href="https://jbferet.github.io/biodivMapR/index.html" class="external-link"><code>biodivMapR</code></a>
performs a filtering combining multiple criteria.</p>
<ul>
<li><p>non vegetated pixels are filtered out with a NDVI thresholding:
all pixels with <code>NDVI &lt; NDVI_Thresh</code> are masked.</p></li>
<li><p>hazy / cloudy pixels are filtered out with a Blue band
thresholding: all pixels with <code>R\text{blue} &gt; Blue_Thresh</code>
are masked.</p></li>
<li><p>shaded pixels are filtered out with a near infrared band
thresholding: all pixels with <code>R\text{nir} &lt; NIR_Thresh</code>
are masked.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##  1.3- spatial filtering: discard with hazy/cloudy, shaded &amp; no vegetation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jbferet/biodivMapR" class="external-link">biodivMapR</a></span><span class="op">)</span></span>
<span><span class="va">NDVI_Thresh</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">Blue_Thresh</span> <span class="op">&lt;-</span> <span class="fl">600</span></span>
<span><span class="va">NIR_Thresh</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span>
<span><span class="va">mask_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/radiometric_filtering.html">radiometric_filtering</a></span><span class="op">(</span>input_raster_path <span class="op">=</span> <span class="va">input_raster_path</span>, </span>
<span>                                   input_rast_wl <span class="op">=</span> <span class="va">sensor_bands</span>,</span>
<span>                                   output_dir <span class="op">=</span> <span class="va">prosail_dir</span>, </span>
<span>                                   NDVI_Thresh <span class="op">=</span> <span class="va">NDVI_Thresh</span>, </span>
<span>                                   Blue_Thresh <span class="op">=</span> <span class="va">Blue_Thresh</span>, </span>
<span>                                   NIR_Thresh <span class="op">=</span> <span class="va">NIR_Thresh</span><span class="op">)</span></span></code></pre></div>
<p>If no mask available, then <code>mask_path</code> should not be
specified as input for <code>apply_prosail_inversion</code>.</p>
</div>
<div class="section level3">
<h3 id="filter-out-spectral-bands-with-low-signal-to-noise-ratio-snr">filter out spectral bands with low signal to noise ratio (SNR)<a class="anchor" aria-label="anchor" href="#filter-out-spectral-bands-with-low-signal-to-noise-ratio-snr"></a>
</h3>
<p>Additional information corresponding to atmospheric transmittance are
also downloaded in order to perform spectral filtering for low
transmittance. Low SNR is <strong>arbitrarily</strong> defined as a
threshold of 0.85. Please investigate how to filter out spectral domains
with low SNR on your own imaging spectroscopy data as it may depend on
sensor, conditions of acquisitions, and other factors. An additional
band showing strong noise after careful analysis is also discarded.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1.4- spectral filtering</span></span>
<span><span class="co"># atmospheric transmittance file available on a repository</span></span>
<span><span class="va">git_repository</span> <span class="op">&lt;-</span> </span>
<span>  <span class="st">'https://gitlab.com/jbferet/myshareddata/-/raw/master/Fabas_HS_AtmoT'</span></span>
<span><span class="va">git_file</span> <span class="op">&lt;-</span> <span class="st">'AtmoT_Fabas_Hyspex.csv'</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">git_repository</span>, <span class="va">git_file</span><span class="op">)</span></span>
<span><span class="va">path_atmo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>,<span class="va">git_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">path_atmo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spectral filtering #1: discard bands with transmission factor&lt;0.85</span></span>
<span><span class="va">transmittance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="va">path_atmo</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">low_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">transmittance</span><span class="op">$</span><span class="va">Transmittance</span><span class="op">&lt;</span><span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="co"># spectral filtering #2: discard noisy band remaining</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">(</span><span class="va">sensor_bands</span> <span class="op">&gt;</span> <span class="fl">2200</span> <span class="op">&amp;</span> <span class="va">sensor_bands</span> <span class="op">&lt;</span> <span class="fl">2205</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># combine bands to discard</span></span>
<span><span class="va">wl_elim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_trans</span>, <span class="va">noise</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="perform-hybrid-inversion-of-prosail-on-imaging-spectroscopy-data">perform hybrid inversion of <code>prosail</code> on imaging
spectroscopy data<a class="anchor" aria-label="anchor" href="#perform-hybrid-inversion-of-prosail-on-imaging-spectroscopy-data"></a>
</h2>
<p>The hybrid inversion implemented in the <code>prosail</code> package
is a bagging prediction of biophysical properties: a LUT is simulated
with prosail and resampled in order to produce multiple datasets
including a limited number of samples. Then a set of individual support
vector regression (SVR) models is trained from each reduced dataset.</p>
<p>The hybrid inversion consists in two main stages for users:</p>
<ul>
<li><p>training of a machine learning regression model (SVR) for each
biophysical property of interest based on surface reflectance factor LUT
simulated with PROSAIL</p></li>
<li><p>application of the SVR models to a dataset provided as a matrix
or as a raster</p></li>
</ul>
<div class="section level3">
<h3 id="preparation-for-a-training-dataset">preparation for a training dataset<a class="anchor" aria-label="anchor" href="#preparation-for-a-training-dataset"></a>
</h3>
<p>The hybrid inversion can be easily parameterized to adapt to any type
of sensor, input parameter distribution, type of noise.</p>
<p>alternative machine learning (ML) methods will be implemented in the
future, and suggestions are welcome for the implementation of
alternative algorithms. Let’s go.</p>
<div class="section level4">
<h4 id="biophysical-variables-of-interest">biophysical variables of interest<a class="anchor" aria-label="anchor" href="#biophysical-variables-of-interest"></a>
</h4>
<p><code>prosail</code> takes into account the influence of multiple
biophysical properties. Each input parameter can be theoretically
estimated through hybrid inversion. However, the relevance and
uncertainty associated with these estimates strongly depends on i) the
type of sensor (spectral information provided), ii) the signal to noise
ratio of the data, and iii) the type of vegetation (keeping in mind that
<code>prosail</code> is based on a turbid hypothesis, hence, not
appropriate for heterogeneous forests).</p>
<p>Here, we will estimate four biophysical properties which will then be
used to compute spectral diversity. These are: - leaf area index
(<code>lai</code>) - leaf chlorophyll content (<code>chl</code>) -
equivalent water thickness (<code>ewt</code>) - leaf mass per area
(<code>lma</code>)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># biophysical variables to estimate</span></span>
<span><span class="va">parms_to_estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lai'</span>, <span class="st">'chl'</span>, <span class="st">'ewt'</span>, <span class="st">'lma'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="spectral-domain-of-inversion">spectral domain of inversion<a class="anchor" aria-label="anchor" href="#spectral-domain-of-inversion"></a>
</h4>
<p>The accuracy of the estimation of vegetation biophysical properties
from remotely sensed data varies with the spectral information provided
to the ML algorithm. Here, we arbitrarily define spectral domains for
each biophysical property of interest. Spectral feature selection may be
used in order to refine the optimal spectral domain for each property.
Noise level to be applied on simulated data is also defined for each
property.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># spectral domain used for estimation of each variable, discard wl_elim</span></span>
<span><span class="va">selected_bands</span> <span class="op">&lt;-</span> <span class="va">noise_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wl_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lai'</span><span class="op">=</span><span class="fl">700</span>, <span class="st">'chl'</span><span class="op">=</span><span class="fl">700</span>, <span class="st">'ewt'</span><span class="op">=</span><span class="fl">1200</span>, <span class="st">'lma'</span><span class="op">=</span><span class="fl">1200</span><span class="op">)</span>,</span>
<span>                       max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lai'</span><span class="op">=</span><span class="fl">900</span>, <span class="st">'chl'</span><span class="op">=</span><span class="fl">900</span>, <span class="st">'ewt'</span><span class="op">=</span><span class="fl">2400</span>, <span class="st">'lma'</span><span class="op">=</span><span class="fl">2400</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">parm</span> <span class="kw">in</span> <span class="va">parms_to_estimate</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bandsel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sensor_bands</span> <span class="op">&gt;</span> <span class="va">wl_train</span><span class="op">[</span><span class="va">parm</span>, <span class="st">'min'</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>                     <span class="va">sensor_bands</span> <span class="op">&lt;</span> <span class="va">wl_train</span><span class="op">[</span><span class="va">parm</span>, <span class="st">'max'</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">selected_bands</span><span class="op">[[</span><span class="va">parm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sensor_bands</span><span class="op">[</span><span class="va">bandsel</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.exclude</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">wl_elim</span>, <span class="va">bandsel</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># 2% relative gaussian noise applied to reflectance data</span></span>
<span>  <span class="va">noise_level</span><span class="op">[[</span><span class="va">parm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.02</span>        </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="geometry-of-acquisition">geometry of acquisition<a class="anchor" aria-label="anchor" href="#geometry-of-acquisition"></a>
</h4>
<p>A rough estimate of the valid range for the geometry of acquisition
should be provided, ideally.</p>
<ul>
<li><p>observer zenith angle <code>tto</code></p></li>
<li><p>sun zenith angle <code>tts</code></p></li>
<li><p>relative azimuth angle <code>psi</code></p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define geometry of acquisition based on location and time of acquisition</span></span>
<span><span class="va">geom_acq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'tto'</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">'tts'</span> <span class="op">=</span> <span class="fl">50</span>, <span class="st">'psi'</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>                       max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'tto'</span> <span class="op">=</span> <span class="fl">15</span>, <span class="st">'tts'</span> <span class="op">=</span> <span class="fl">70</span>, <span class="st">'psi'</span> <span class="op">=</span> <span class="fl">360</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="input-parameter-distribution">input parameter distribution<a class="anchor" aria-label="anchor" href="#input-parameter-distribution"></a>
</h4>
<p>Users can define distribution and range for each input parameter of
<code>prospect</code>. However, for the sake of straightforwardness, the
parameterization defined in the <a href="https://step.esa.int/docs/extra/ATBD_S2ToolBox_V2.1.pdf" class="external-link">Algorithm
Theoretical Based Document</a> (ATBD) of the Sentinel-2 toolbox will be
used here.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use same distribution as used in ATBD for Sentinel-2 data</span></span>
<span><span class="va">input_prosail</span> <span class="op">&lt;-</span> <span class="fu">get_input_prosail</span><span class="op">(</span>atbd <span class="op">=</span> <span class="cn">TRUE</span>, geom_acq <span class="op">=</span> <span class="va">geom_acq</span><span class="op">)</span></span>
<span><span class="co"># waiting for updated soil database, deactivate soil v3 </span></span>
<span><span class="va">input_prosail</span><span class="op">$</span><span class="va">soil_brightness</span> <span class="op">&lt;-</span> <span class="va">input_prosail</span><span class="op">$</span><span class="va">soil_ID</span>  <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="spectral-response-function">spectral response function<a class="anchor" aria-label="anchor" href="#spectral-response-function"></a>
</h4>
<p>The spectral response function (SRF) needs to be defined in order to
simulate sensor reflectance.</p>
<p>The SRF of several sensors is already implemented in
<code>prosail</code>: Sentinel-2, Landsat-7, Landsat-8, Landsat-9, SPOT
6/7, MODIS, Pleiades, and Venus.</p>
<p>Here, the SRF of the hyperspectral sensor is produced from central
wavelengths and FWHM based on a gaussian response model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get sensor response function corresponding to the sensor</span></span>
<span><span class="va">sensor_name</span> <span class="op">&lt;-</span> <span class="st">'Hyspex'</span></span>
<span><span class="va">srf</span> <span class="op">&lt;-</span> <span class="fu">get_srf_sensor</span><span class="op">(</span>sensor_name <span class="op">=</span> <span class="va">sensor_name</span>, </span>
<span>                      wl <span class="op">=</span> <span class="va">sensor_bands</span>, </span>
<span>                      fwhm <span class="op">=</span> <span class="va">sensor_fwhm</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="train-ml-regression-algorithms-with-simulated-data">train ML regression algorithms with simulated data<a class="anchor" aria-label="anchor" href="#train-ml-regression-algorithms-with-simulated-data"></a>
</h3>
<p>The function <code>train_prosail_inversion</code> performs the
training of the ML algorithm based on the information generated in the
previous steps. It provides a set of regression models for each
biophysical property to estimate.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">'training ML regression with prosail simulations'</span><span class="op">)</span></span>
<span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu">set_options_prosail</span><span class="op">(</span>fun <span class="op">=</span> <span class="st">'train_prosail_inversion'</span><span class="op">)</span></span>
<span><span class="va">options</span><span class="op">$</span><span class="va">noise_level</span> <span class="op">&lt;-</span> <span class="va">noise_level</span></span>
<span><span class="va">hybrid_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/prosail/man/train_prosail_inversion.html" class="external-link">train_prosail_inversion</a></span><span class="op">(</span>input_prosail <span class="op">=</span> <span class="va">input_prosail</span>, </span>
<span>                                        parms_to_estimate <span class="op">=</span> <span class="va">parms_to_estimate</span>,</span>
<span>                                        geom_acq <span class="op">=</span> <span class="va">geom_acq</span>, </span>
<span>                                        srf <span class="op">=</span> <span class="va">srf</span>,</span>
<span>                                        selected_bands <span class="op">=</span> <span class="va">selected_bands</span>,</span>
<span>                                        output_dir <span class="op">=</span> <span class="va">prosail_dir</span>, </span>
<span>                                        options <span class="op">=</span> <span class="va">options</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-ml-regression-algorithms-on-images">apply ML regression algorithms on images<a class="anchor" aria-label="anchor" href="#apply-ml-regression-algorithms-on-images"></a>
</h3>
<p>The function <code>apply_prosail_inversion</code> applies ML
regression trained at the previous step on raster data. As for <a href="https://jbferet.gitlab.io/tutorial_puertorico2025/compute-spectral-indices-from-sentinel-2-image.html#computing-spectral-indices-from-sentinel-2-raster" class="external-link">spectral
indices</a>, a grid is first defined on the aoi. Model inversion is then
applied individually for each tile. The current version of prosail does
not support multiprocessing for the application of ML algorithm, but
suggestions are welcome for its implementation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># apply models on image</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">'applying ML regression on image'</span><span class="op">)</span></span>
<span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu">set_options_prosail</span><span class="op">(</span>fun <span class="op">=</span> <span class="st">'apply_prosail_inversion_per_tile'</span><span class="op">)</span></span>
<span><span class="va">options</span><span class="op">$</span><span class="va">tiling</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>      <span class="co"># process image per square tile</span></span>
<span><span class="va">options</span><span class="op">$</span><span class="va">tile_size</span> <span class="op">&lt;-</span> <span class="fl">1000</span>   <span class="co"># dimensions of individual square tile (in meters)</span></span>
<span><span class="va">BPvars</span> <span class="op">&lt;-</span> <span class="fu">apply_prosail_inversion</span><span class="op">(</span>raster_path <span class="op">=</span> <span class="va">input_raster_path</span>, </span>
<span>                                  mask_path <span class="op">=</span> <span class="va">mask_path</span>, </span>
<span>                                  output_dir <span class="op">=</span> <span class="va">prosail_tiles</span>,</span>
<span>                                  hybrid_model <span class="op">=</span> <span class="va">hybrid_model</span>, </span>
<span>                                  band_names <span class="op">=</span> <span class="va">sensor_bands</span>,</span>
<span>                                  selected_bands <span class="op">=</span> <span class="va">selected_bands</span>, </span>
<span>                                  options <span class="op">=</span> <span class="va">options</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="resulting-biophysical-properties">resulting biophysical properties<a class="anchor" aria-label="anchor" href="#resulting-biophysical-properties"></a>
</h3>
<p>The maps corresponding to the biophysical variables estimated from
imaging spectroscopy data are displayed below.</p>
<p><img src="https://gitlab.com/jbferet/myshareddata/-/raw/master/biodivMapR_vignette_illustrations/05_bp_prosail.png" class="r-plt" alt="" width="100%"></p>
<center>
Fig. 2. maps of vegetation biophysical variables <code>chl</code>,
<code>lai</code>, <code>ewt</code> and <code>lma</code> obtained over
the Fabas forest. The variables were estimated from physical model
hybrid inversion applied to imaging spectroscopy and performed with the
<code>prosail</code> package.
</center>
<p>
 
</p>
</div>
</div>
<div class="section level2">
<h2 id="apply-biodivmapr-on-biophysical-prioperties-estimated-with-prosail">apply <code>biodivMapR</code> on biophysical prioperties estimated
with <code>prosail</code><a class="anchor" aria-label="anchor" href="#apply-biodivmapr-on-biophysical-prioperties-estimated-with-prosail"></a>
</h2>
<div class="section level3">
<h3 id="parameterize-biodivmapr">parameterize <code>biodivMapR</code><a class="anchor" aria-label="anchor" href="#parameterize-biodivmapr"></a>
</h3>
<p>The directory where tiles corresponding to biophysical properties are
stored needs to be provided. <code>biodivMapR</code> will then identify
files with pattern matching with each biophysical property, and the
identifier of the tile. the grid produced during the
<code>prosail</code> inversion is also used</p>
<p>Multiple options can be defined with the
<code>set_options_biodivMapR</code> function. Here, we defined
<code>options$moving_window &lt;- TRUE</code>. This results in a moving
window process instead of cell grid process, with map produced with the
same spatial resolution as original input data. While this option
produces visually more satisfying outputs, it results in signifiantly
higher computation time. Hence, <strong>we do not recommend setting this
option to TRUE if large image datasets are processed</strong>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># -----------------------------------------------------------------------------</span></span>
<span><span class="co"># prepare for biodivMapR to run on the set of biophysical properties estimated </span></span>
<span><span class="co"># in previous step</span></span>
<span><span class="co"># -----------------------------------------------------------------------------</span></span>
<span><span class="co"># define output directories</span></span>
<span><span class="va">prosail_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'prosail_inversion/tiles/mean'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># directory where mask is stored</span></span>
<span><span class="va">mask_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'mask_tiles'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">mask_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># directory where diversity maps are stored</span></span>
<span><span class="va">biodivMapR_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'biodivMapR'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">biodivMapR_dir</span>, showWarnings <span class="op">=</span> <span class="cn">F</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define grid to perform diversity mapping</span></span>
<span><span class="va">aoi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">input_raster_dir</span>, <span class="st">'aoi_tiles_1000m.gpkg'</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">aoi_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nb_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/preprocS2/man/get_plot_list.html" class="external-link">get_plot_list</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">aoi_path</span>, nbdigits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">nb_plots</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># -----------------------------------------------------------------------------</span></span>
<span><span class="co"># run biodivMapR </span></span>
<span><span class="co"># -----------------------------------------------------------------------------</span></span>
<span><span class="co"># define biodivMapR parameters and options</span></span>
<span><span class="va">window_size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">nbCPU</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span></span>
<span><span class="co"># set optional parameters</span></span>
<span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_options_biodivMapR.html">set_options_biodivMapR</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">'biodivMapR_full_tiles'</span>, options <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">options</span><span class="op">$</span><span class="va">alpha_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'hill'</span>, <span class="st">'shannon'</span><span class="op">)</span> </span>
<span><span class="va">options</span><span class="op">$</span><span class="va">beta_metrics</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">options</span><span class="op">$</span><span class="va">moving_window</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">options</span><span class="op">$</span><span class="va">nb_clusters</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">site_name</span> <span class="op">&lt;-</span> <span class="st">'Fabas_HS_mosaic'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-biodivmapr">run <code>biodivMapR</code><a class="anchor" aria-label="anchor" href="#run-biodivmapr"></a>
</h3>
<p><code>biodivMapR</code> can run directly using a unique function
<code>biodivMapR_full_tiles</code>, as illustrated in the code
hereafter.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run biodivmapR on tiles defined when processing prosail inversion</span></span>
<span><span class="va">ResDiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/biodivMapR_full_tiles.html">biodivMapR_full_tiles</a></span><span class="op">(</span>feature_dir <span class="op">=</span> <span class="va">prosail_dir</span>, </span>
<span>                                list_features <span class="op">=</span> <span class="va">parms_to_estimate</span>, </span>
<span>                                site_name <span class="op">=</span> <span class="va">site_name</span>, </span>
<span>                                mask_dir <span class="op">=</span> <span class="va">mask_dir</span>, </span>
<span>                                plots <span class="op">=</span> <span class="va">plots</span>, </span>
<span>                                output_dir <span class="op">=</span> <span class="va">biodivMapR_dir</span>, </span>
<span>                                window_size <span class="op">=</span> <span class="va">window_size</span>, </span>
<span>                                nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, </span>
<span>                                options <span class="op">=</span> <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<p>Figure 3 displays the Hill index obtained from
<code>biodivMapR</code>, and allows comparison with the forest stand
composition corresponding to pure (blue) and mixed (red) forest stands,
as described in the <a href="https://geoservices.ign.fr/bdforet" class="external-link">BD
Foret</a>.</p>
<p><img src="https://gitlab.com/jbferet/myshareddata/-/raw/master/biodivMapR_vignette_illustrations/05_alpha_ground.gif" class="r-plt" alt="" width="100%"></p>
<center>
Fig. 3. map of of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>-diversity
(hill index) obtained from <code>biodivMapR</code> analysis on
biophysical variables from imaging spectroscopy acquisition. The
variables were estimated from physical model hybrid inversion applied to
imaging spectroscopy and performed with the <code>prosail</code>
package. The map is compared with forest stand composition corresponding
to pure (blue) and mixed (red) forest stands.
</center>
<p>
 
</p>
<p>Figure 4 displays the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>-diversity
obtained from <code>biodivMapR</code>, and allows comparison with the
forest stand composition, as described in the <a href="https://geoservices.ign.fr/bdforet" class="external-link">BD Foret</a>.</p>
<p><img src="https://gitlab.com/jbferet/myshareddata/-/raw/master/biodivMapR_vignette_illustrations/05_beta_ground.gif" class="r-plt" alt="" width="100%"></p>
<center>
Fig. 4. map of of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>-diversity
obtained from <code>biodivMapR</code> analysis on biophysical variables
from imaging spectroscopy acquisition. The variables were estimated from
physical model hybrid inversion applied to imaging spectroscopy and
performed with the <code>prosail</code> package. The map is compared
with forest stand composition corresponding to pure (blue) and mixed
(red) forest stands.
</center>
<p>
 
</p>
</div>
<div class="section level3">
<h3 id="validate-biodivmapr-with-ground-data">validate <code>biodivMapR</code> with ground data<a class="anchor" aria-label="anchor" href="#validate-biodivmapr-with-ground-data"></a>
</h3>
<p>The diversity metrics computed with <code>biodivMapR</code> can then
be compared with ground information obtained from forest
inventories.</p>
<p>The validation plots &amp; inventories can be downloaded from a
<code>gpkg</code> file available at <a href="https://doi.org/10.57745/NHRNOR" class="external-link">this webpage</a>.</p>
<p>The code below allows arranging the ground information.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># -----------------------------------------------------------------------------</span></span>
<span><span class="co"># prepare inventory data for analysis and comparison with biodivMapR estimates</span></span>
<span><span class="co"># -----------------------------------------------------------------------------</span></span>
<span><span class="co"># define input &amp; output directories</span></span>
<span><span class="va">input_vect_dir</span> <span class="op">&lt;-</span> <span class="st">'../01_data/vector_data'</span></span>
<span><span class="va">prosail_bp_vrt_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'prosail_inversion/tiles/vrt'</span><span class="op">)</span></span>
<span><span class="va">mask_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'mask_tiles'</span><span class="op">)</span></span>
<span><span class="va">biodivMapR_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'biodivMapR'</span><span class="op">)</span></span>
<span><span class="va">validation_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">'validation'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">validation_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># produce virtual rasters for spectral features to be used</span></span>
<span><span class="co"># create a vrt</span></span>
<span><span class="va">bp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">bp</span> <span class="kw">in</span> <span class="va">parms_to_estimate</span><span class="op">)</span></span>
<span>  <span class="va">bp_path</span><span class="op">[[</span><span class="va">bp</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">prosail_bp_vrt_dir</span>, pattern <span class="op">=</span> <span class="va">bp</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mask create a vrt</span></span>
<span><span class="va">listfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">mask_dir</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">listfiles</span> <span class="op">&lt;-</span> <span class="va">listfiles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">'.tiff'</span>, x <span class="op">=</span> <span class="va">listfiles</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mask_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">validation_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">site_name</span>, <span class="st">'_mask_mosaic.vrt'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vrt.html" class="external-link">vrt</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">listfiles</span>, filename <span class="op">=</span> <span class="va">mask_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># arrange inventory data to get diversity metrics</span></span>
<span><span class="co"># The inventory data needs a bit of process to get the abundance table which </span></span>
<span><span class="co"># will then be used to produce diversity metrics.</span></span>
<span><span class="co"># The function get_inventory_from_species_list will to the job.</span></span>
<span><span class="va">get_inventory_from_species_list</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">validation_plots</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">SpList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">validation_plots</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Species1'</span>, <span class="st">'Species2'</span>, </span>
<span>                                              <span class="st">'Species3'</span>, <span class="st">'Species4'</span>, </span>
<span>                                              <span class="st">'Species5'</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">SpList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">SpList</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># create species abundance table from inventory data</span></span>
<span>  <span class="va">inventory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>,  </span>
<span>                                 nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">validation_plots</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span>, </span>
<span>                                 ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SpList</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">inventory</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">SpList</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">inventory</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">validation_plots</span><span class="op">$</span><span class="va">ID</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">PlotID</span> <span class="kw">in</span> <span class="va">validation_plots</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">whichPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">validation_plots</span><span class="op">$</span><span class="va">ID</span> <span class="op">==</span> <span class="va">PlotID</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">sp</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">wsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">SpList</span> <span class="op">==</span> <span class="va">validation_plots</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Species'</span>,<span class="va">sp</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">whichPlot</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wsp</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">Abundspi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'%Cover_Species'</span>,<span class="va">sp</span><span class="op">)</span></span>
<span>        <span class="va">inventory</span><span class="op">[</span><span class="va">whichPlot</span>,<span class="va">SpList</span><span class="op">[</span><span class="va">wsp</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">validation_plots</span><span class="op">[[</span><span class="va">Abundspi</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">whichPlot</span><span class="op">]</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">inventory</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># We can then get the diversity metrics we are interested in.</span></span>
<span><span class="va">vect_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">input_vect_dir</span>, <span class="st">'forestPLOT_Fabas_2019.gpkg'</span><span class="op">)</span></span>
<span><span class="va">validation_plots</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">vect_path</span><span class="op">)</span></span>
<span><span class="va">inventory</span> <span class="op">&lt;-</span> <span class="fu">get_inventory_from_species_list</span><span class="op">(</span><span class="va">validation_plots</span><span class="op">)</span></span>
<span><span class="co"># compute diversity metrics from abundance table</span></span>
<span><span class="va">plotID</span> <span class="op">&lt;-</span> <span class="va">validation_plots</span><span class="op">$</span><span class="va">ID</span></span>
<span><span class="va">shannon_obs</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://vegandevs.github.io/vegan/reference/diversity.html" class="external-link">diversity</a></span><span class="op">(</span><span class="va">inventory</span>, index <span class="op">=</span> <span class="st">"shannon"</span><span class="op">)</span></span>
<span><span class="va">richness_obs</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://vegandevs.github.io/vegan/reference/diversity.html" class="external-link">specnumber</a></span><span class="op">(</span><span class="va">inventory</span><span class="op">)</span></span>
<span><span class="va">bc_obs</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://vegandevs.github.io/vegan/reference/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">inventory</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># extract spectral diversity metrics from plots footprint</span></span>
<span><span class="co"># We can then use information produced at the previous step in order to get </span></span>
<span><span class="co"># diversity metrics from plot footprint. </span></span>
<span><span class="co"># plots are expected to be polygons, not points. Apply buffer if needed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">biodivMapR_dir</span>, <span class="st">'Kmeans_info.RData'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">biodivMapR_dir</span>, <span class="st">'Beta_info.RData'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">input_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">bp_path</span>, FUN <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="va"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">)</span></span>
<span><span class="va">input_mask</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">mask_path</span><span class="op">)</span></span>
<span><span class="va">alpha_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'richness'</span>, <span class="st">'shannon'</span>, <span class="st">'simpson'</span>, <span class="st">'hill'</span><span class="op">)</span> </span>
<span><span class="va">fd_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'FRic'</span>, <span class="st">'FEve'</span>, <span class="st">'FDiv'</span>, <span class="st">'FDis'</span>, <span class="st">'FRaoq'</span><span class="op">)</span> </span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_diversity_from_plots.html">get_diversity_from_plots</a></span><span class="op">(</span>input_rast <span class="op">=</span> <span class="va">input_rast</span>, </span>
<span>                                       input_mask <span class="op">=</span> <span class="va">input_mask</span>, </span>
<span>                                       validation_vect <span class="op">=</span> <span class="va">validation_plots</span>, </span>
<span>                                       Kmeans_info <span class="op">=</span> <span class="va">Kmeans_info</span>, </span>
<span>                                       Beta_info <span class="op">=</span> <span class="va">Beta_info</span>, </span>
<span>                                       alpha_metrics <span class="op">=</span> <span class="va">alpha_metrics</span>,</span>
<span>                                       fd_metrics <span class="op">=</span> <span class="va">fd_metrics</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-biodivmapr-with-ground-data">compare <code>biodivMapR</code> with ground data<a class="anchor" aria-label="anchor" href="#compare-biodivmapr-with-ground-data"></a>
</h3>
<p>The following code allows production of a figure comparing measured
and estimated diversity metrics.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># produce scatterplots comparing inventory data with spectral diversity</span></span>
<span><span class="co"># The code below produces a scatterplot comparing diversity metrics derived from</span></span>
<span><span class="co"># forest inventories with diversity metrics produced with biodivMapR.</span></span>
<span></span>
<span><span class="co"># richness</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="va">validation</span><span class="op">$</span><span class="va">specdiv</span><span class="op">$</span><span class="va">richness_mean</span></span>
<span><span class="va">df_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'measured'</span> <span class="op">=</span> <span class="va">richness_obs</span>,</span>
<span>                          <span class="st">'predicted'</span> <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span></span>
<span><span class="co"># shannon</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="va">validation</span><span class="op">$</span><span class="va">specdiv</span><span class="op">$</span><span class="va">shannon_mean</span></span>
<span><span class="va">df_shannon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'measured'</span> <span class="op">=</span> <span class="va">shannon_obs</span>,</span>
<span>                         <span class="st">'predicted'</span> <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span></span>
<span><span class="co"># Bray-Curtis dissimilarity</span></span>
<span><span class="va">BCdissmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">BC_dissimilarity</span>, diag <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Field_Beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="va">bc_obs</span>, diag <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_beta_estimated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'measured'</span> <span class="op">=</span> <span class="va">Field_Beta</span>,</span>
<span>                                <span class="st">'predicted'</span> <span class="op">=</span> <span class="va">BCdissmat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  `Spectral species richness` <span class="op">=</span> <span class="va">df_richness</span>,</span>
<span>  `Shannon's H` <span class="op">=</span> <span class="va">df_shannon</span>,</span>
<span>  `BC dissimilarity` <span class="op">=</span> <span class="va">df_beta_estimated</span><span class="op">)</span>, idcol <span class="op">=</span> <span class="st">'Metric'</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">plot_data</span>, </span>
<span>                           Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Metric</span>, </span>
<span>                                           levels <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Metric</span><span class="op">)</span>, </span>
<span>                                           labels <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Metric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">measured</span>, <span class="va">predicted</span>, color<span class="op">=</span><span class="va">Metric</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Metric</span>, scales<span class="op">=</span><span class="st">"free"</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggpmisc</span><span class="fu">::</span><span class="fu">stat_correlation</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"spearman"</span>, </span>
<span>                            label.x <span class="op">=</span> <span class="st">"right"</span>, </span>
<span>                            label.y <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>                            color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"label"</span>, colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">validation_dir</span>, <span class="st">'Validation_AlphaBeta.png'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">filename</span>, plot <span class="op">=</span> <span class="va">plotval</span>, device <span class="op">=</span> <span class="st">'png'</span>, path <span class="op">=</span> <span class="cn">NULL</span>, scale <span class="op">=</span> <span class="fl">0.75</span>, </span>
<span>       width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">4</span>, units <span class="op">=</span> <span class="st">"in"</span>, dpi <span class="op">=</span> <span class="fl">600</span>, limitsize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Figure 5 displays the comparison between diversity metrics obtained
from forest inventories and those obtained from <code>biodivMapR</code>
applied to biophysical properties obtained from imaging
spectroscopy.</p>
<p><img src="https://gitlab.com/jbferet/myshareddata/-/raw/master/biodivMapR_vignette_illustrations/05_Validation_AlphaBeta.png" class="r-plt" alt="" width="100%"></p>
<center>
Fig. 5. comparison between diversity metrics obtained from forest
inventories and those obtained from <code>biodivMapR</code> applied to
biophysical properties obtained from imaging spectroscopy. from left to
right: species vs. spectral richness; species vs. spectral Shannon,
species vs. spectral bray curtis dissimilarity.
</center>
<p>
 
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean-Baptiste Feret, Florian de Boissieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
