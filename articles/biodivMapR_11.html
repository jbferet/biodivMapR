<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROGYSAT#1: download S2 data • biodivMapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PROGYSAT#1: download S2 data">
<meta property="og:description" content="biodivMapR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivMapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.14.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biodivMapR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/biodivMapR_01.html">Prepare your data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_02.html">Set parameters for biodivMapR</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_03.html">Perform spatial &amp; spectral filtering</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_04.html">PCA &amp; Dimensionality reduction</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_05.html">Spectral species mapping</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_06.html">alpha and beta diversity maps</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_07.html">Functional Diversity</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_08.html">How to perform validation?</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_09.html">Compute diversity from user-defined set of layers</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_10.html">Map diversity from Lautaret HS image</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_11.html">PROGYSAT#1: download S2 data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_12.html">PROGYSAT#2: Run biodivMapR on S2 reflectance data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_13.html">PROGYSAT#3: Run biodivMapR on selected spectral indices</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_14.html">COPERNICUS &amp; biodiv #1: set working environment</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_15.html">COPERNICUS &amp; biodiv #2: Get reference data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_16.html">COPERNICUS &amp; biodiv #3: check S2 availability</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_17.html">COPERNICUS &amp; biodiv #4: download</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_18.html">COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 reflectance</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_19.html">COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 spectral indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbferet/biodivMapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PROGYSAT#1: download S2 data</h1>
                        <h4 data-toc-skip class="author">Jean-Baptiste
Féret</h4>
            
            <h4 data-toc-skip class="date">2023-12-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbferet/biodivMapR/blob/HEAD/vignettes/biodivMapR_11.Rmd" class="external-link"><code>vignettes/biodivMapR_11.Rmd</code></a></small>
      <div class="hidden name"><code>biodivMapR_11.Rmd</code></div>

    </div>

    
    
<p>This tutorial illustrates how to download and preprocess Sentinel-2
data for the application of <code>biodivMapR</code> in order to map
spectral diversity over a site in Suriname.</p>
<p>This first step is based on the R package <a href="https://jbferet.gitlab.io/preprocS2/index.html" class="external-link"><code>preprocS2</code></a>,
which needs to be installed, along with additional packages such as <a href="https://sen2r.ranghetti.info/" class="external-link"><code>sen2r</code></a></p>
<p>This includes:</p>
<ul>
<li><p>S2 data download based on a spatial footprint</p></li>
<li><p>atmospheric correction of S2 images to produce L2A images with
Sen2Cor</p></li>
<li><p>cropping, stacking and writing the reflectance raster
corresponding to the spatial footprint, as well as the corresponding
cloud mask</p></li>
</ul>
<div class="section level3">
<h3 id="define-structure-for-data-r-scripts-and-results">Define structure for data, R scripts and results<a class="anchor" aria-label="anchor" href="#define-structure-for-data-r-scripts-and-results"></a>
</h3>
<p>This tutorial will assume that the file structure is defined as
follows:</p>
<ul>
<li><p><code>01_DATA</code>: a directory including original vector and
raster files: Sentinel-2 data products level L1C and L2A before further
process (full tile)</p></li>
<li><p><code>02_PROGRAMS</code>: a directory including all r scripts
should be located. All R scripts provided in this tutorial will assume
that this is your working directory</p></li>
<li><p><code>03_RESULTS</code>: a directory including files resulting
from the application of the R scripts on the data located in
<code>01_DATA</code>, or in this same <code>03_RESULTS</code>
directory</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="download-a-vector-file-corresponding-to-the-spatial-footprint-of-the-study-area">Download a vector file corresponding to the spatial footprint of the
study area<a class="anchor" aria-label="anchor" href="#download-a-vector-file-corresponding-to-the-spatial-footprint-of-the-study-area"></a>
</h3>
<p>You can use QGIS, Google Earth, or any relevant GIS or R package to
define the spatial footprint of your area of interest. Save it as kml
file or shapefile in <code>01_DATA</code>.</p>
<p>Here, we drew a rectangular polygon over a forested area in the
Eastern part of the Brokopondo reservoir in Suriname.</p>
<p>First, let’s download the kml file corresponding to our area of
interest from my gitlab repository, and save it locally in the
<code>01_DATA</code> directory.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define data directory</span></span>
<span><span class="va">Path_Data</span> <span class="op">&lt;-</span> <span class="st">'../01_DATA'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">Path_Data</span>,showWarnings <span class="op">=</span> <span class="cn">F</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># name zip file including plots located on the tile</span></span>
<span><span class="va">destkml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Data</span>,<span class="st">'Suriname_Progysat_Workshop.kml'</span><span class="op">)</span></span>
<span><span class="co"># url for the zip file</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">'https://gitlab.com/jbferet/myshareddata/-/raw/master/PROGYSAT/01_DATA/Suriname_Progysat_Workshop.kml'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">destkml</span><span class="op">)</span></span></code></pre></div>
<p>The study area corresponding to the Eastern part of the
<strong>Brokopondo reservoir</strong> is represented by the red square
in the figure below.</p>
<p>
 
</p>
<center>
<img align="bottom" width="100%" height="100%" src="https://gitlab.com/jbferet/myshareddata/-/raw/master/PROGYSAT/04_FIGURES/01_StudySite.jpg">
</center>
<p>
 
</p>
</div>
<div class="section level3">
<h3 id="download-sentinel-2-data-and-perform-atmospheric-corrections-with-sen2cor">Download Sentinel-2 data and perform atmospheric corrections with
sen2Cor<a class="anchor" aria-label="anchor" href="#download-sentinel-2-data-and-perform-atmospheric-corrections-with-sen2cor"></a>
</h3>
<p>Then, we use <a href="https://apps.sentinel-hub.com/eo-browser/?zoom=11&amp;lat=4.7602&amp;lng=-54.92889&amp;themeId=DEFAULT-THEME&amp;visualizationUrl=https%3A%2F%2Fservices.sentinel-hub.com%2Fogc%2Fwms%2Fbd86bcc0-f318-402b-a145-015f85b9427e&amp;datasetId=S2L2A&amp;fromTime=2020-10-16T00%3A00%3A00.000Z&amp;toTime=2020-10-16T23%3A59%3A59.999Z&amp;layerId=1_TRUE_COLOR&amp;demSource3D=%22MAPZEN%22" class="external-link">Sentinel-hub</a>
in order to identify an acquisition corresponding to our
requirement.</p>
<p>Once the S2 tile and the date of acquisition are identified, we can
proceed to the image download. Here, the acquisition is from October
16th, 2020 showed was one of the cleanest image available from the
Sentinel-2 archive.</p>
<p>
 
</p>
<center>
<img align="bottom" width="100%" height="100%" src="https://gitlab.com/jbferet/myshareddata/-/raw/master/PROGYSAT/04_FIGURES/02_SentinelHub.png">
</center>
<p>
 
</p>
<p>We use the R package <a href="https://jbferet.gitlab.io/preprocS2/index.html" class="external-link"><code>preprocS2</code></a>
to download the corresponding Sentinel-2 SAFE archive. Here, level-2A
images (i.e. atmospherically corrected with Sen2Cor) are not available,
and only Level-1C images can be downloaded from the <a href="https://scihub.copernicus.eu" class="external-link">Copernicus Hub</a>.</p>
<p>The function <code>get_S2_L2A_Image</code> allows to automatically
download S2 images (from Copernicus Hub, Google Cloud or Google Earth
Engine when properly parameterized) and to perform atmospheric
corrections with Sen2Cor if only L1C data is available.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">## S2 download &amp; atmospheric correction using preprocS2</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">preprocS2</span><span class="op">)</span></span>
<span><span class="co"># define date of S2 acquisition</span></span>
<span><span class="va">dateAcq</span> <span class="op">&lt;-</span> <span class="st">'2020-10-16'</span></span>
<span><span class="co"># define path for study area</span></span>
<span><span class="va">path_vector</span> <span class="op">&lt;-</span> <span class="va">destkml</span></span>
<span><span class="co"># define output directory where SAFE L2C and L2A files are stored. L1C is </span></span>
<span><span class="co"># automatically deleted after production of L2A to save space</span></span>
<span><span class="va">DirWrite</span> <span class="op">&lt;-</span> <span class="st">'../01_DATA/S2_Images'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">DirWrite</span>,showWarnings <span class="op">=</span> <span class="cn">F</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Path_S2</span> <span class="op">&lt;-</span> <span class="fu">get_S2_L2A_Image</span><span class="op">(</span>l2a_path <span class="op">=</span> <span class="va">DirWrite</span>, </span>
<span>                            spatial_extent <span class="op">=</span> <span class="va">path_vector</span>, </span>
<span>                            dateAcq <span class="op">=</span> <span class="va">dateAcq</span>,</span>
<span>                            DeleteL1C <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                            Sen2Cor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-cropped-stacked-boa-reflectance-and-corresponding-cloud-mask">Save cropped &amp; stacked BOA reflectance and corresponding cloud
mask<a class="anchor" aria-label="anchor" href="#save-cropped-stacked-boa-reflectance-and-corresponding-cloud-mask"></a>
</h3>
<p>Sentinel-2 products are made available in the <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-2-msi/data-formats" class="external-link">SAFE</a>
format, including image data in JPEG2000 format, quality indicators
(e.g. defective pixels mask), auxiliary data and metadata.</p>
<p>The <code>preprocS2</code> function <code>extract_from_S2_L2A</code>
aims at extracting all information required for further processing,
including reflectance data, cloud mask and metadata, and rearrange it in
a more user-friendly fashion (personal opinion). It also crops S2 data
following a spatial extent defined by <code>path_vector</code>, and it
harmonizes the spatial resolution to either 20 meters, or 10 meters
using user defined interpolation (bilinear as default, change it with
the input variable <code>interpolation</code> set to the method of your
choice available in GDAL).</p>
<p>If the vector file and the raster data do not share the same
projection, the vector file is also reprojected to avoid possible errors
in future processings.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">## write a stacked reflectance raster corresponding to the study area</span></span>
<span><span class="co">################################################################################</span></span>
<span><span class="co"># Result directory where data is stored </span></span>
<span><span class="va">result_path</span> <span class="op">&lt;-</span> <span class="st">'../03_RESULTS'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">result_path</span>,showWarnings <span class="op">=</span> <span class="cn">FALSE</span>,recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##____________________________________________________________________________##</span></span>
<span><span class="co">##      Extract, resample all bands to 10m spatial resolution &amp; stack data    ##</span></span>
<span><span class="co">##----------------------------------------------------------------------------##</span></span>
<span><span class="co"># define spatial resolution</span></span>
<span><span class="va">resolution</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># define source of data</span></span>
<span><span class="va">S2source</span> <span class="op">&lt;-</span> <span class="st">'SAFE'</span></span>
<span><span class="va">S2obj</span> <span class="op">&lt;-</span> <span class="fu">preprocS2</span><span class="fu">::</span><span class="fu">extract_from_S2_L2A</span><span class="op">(</span>Path_dir_S2 <span class="op">=</span> <span class="va">Path_S2</span>,</span>
<span>                                        path_vector <span class="op">=</span> <span class="va">path_vector</span>,</span>
<span>                                        S2source <span class="op">=</span> <span class="va">S2source</span>,</span>
<span>                                        resolution <span class="op">=</span> <span class="va">resolution</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update vector file if needed (reprojection and write as shapefile in the same </span></span>
<span><span class="co"># location as the original file)</span></span>
<span><span class="va">path_vector</span> <span class="op">&lt;-</span> <span class="va">S2obj</span><span class="op">$</span><span class="va">path_vector</span></span></code></pre></div>
<p>A stars object is obtained as output from
<code>extract_from_S2_L2A</code>. This is a proxy stars object, in order
to handle large rasters. This stars object includes the reflectance data
and corresponding cloud mask.</p>
<p>These will be written on your local space with the functions
<code>save_cloud_s2</code> and <code>save_reflectance_s2</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create specific result directory corresponding to granule name</span></span>
<span><span class="va">results_site_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">result_path</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Bands</span><span class="op">$</span><span class="va">GRANULE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">results_site_path</span>,showWarnings <span class="op">=</span> <span class="cn">FALSE</span>,recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Write CLOUD MASK</span></span>
<span><span class="va">cloudmasks</span> <span class="op">&lt;-</span> <span class="fu">preprocS2</span><span class="fu">::</span><span class="fu">save_cloud_s2</span><span class="op">(</span>S2_stars <span class="op">=</span> <span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Stack</span>,</span>
<span>                                       Cloud_path <span class="op">=</span> <span class="va">results_site_path</span>,</span>
<span>                                       S2source <span class="op">=</span> <span class="va">S2source</span>, SaveRaw <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Write REFLECTANCE</span></span>
<span><span class="co"># Save Reflectance file as ENVI image with BIL interleaves</span></span>
<span><span class="co"># metadata files are also important to account for offset applied on S2 L2A products </span></span>
<span><span class="va">Refl_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">results_site_path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Bands</span><span class="op">$</span><span class="va">GRANULE</span><span class="op">)</span>,<span class="st">'_Refl'</span>,sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tile_S2</span> <span class="op">&lt;-</span> <span class="fu">get_tile</span><span class="op">(</span><span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Bands</span><span class="op">$</span><span class="va">GRANULE</span><span class="op">)</span></span>
<span><span class="va">dateAcq_S2</span> <span class="op">&lt;-</span> <span class="fu">get_date</span><span class="op">(</span><span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Bands</span><span class="op">$</span><span class="va">GRANULE</span><span class="op">)</span></span>
<span><span class="fu">preprocS2</span><span class="fu">::</span><span class="fu">save_reflectance_s2</span><span class="op">(</span>S2_stars <span class="op">=</span> <span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Stack</span>, </span>
<span>                               Refl_path <span class="op">=</span> <span class="va">Refl_path</span>,</span>
<span>                               S2Sat <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                               tile_S2 <span class="op">=</span> <span class="va">tile_S2</span>, </span>
<span>                               dateAcq_S2 <span class="op">=</span> <span class="va">dateAcq_S2</span>,</span>
<span>                               Format <span class="op">=</span> <span class="st">'ENVI'</span>, </span>
<span>                               datatype <span class="op">=</span> <span class="st">'Int16'</span>, </span>
<span>                               MTD <span class="op">=</span> <span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Bands</span><span class="op">$</span><span class="va">metadata</span>, </span>
<span>                               MTD_MSI <span class="op">=</span> <span class="va">S2obj</span><span class="op">$</span><span class="va">S2_Bands</span><span class="op">$</span><span class="va">metadata_MSI</span><span class="op">)</span></span></code></pre></div>
<p>The cropped image and binary mask obtained from this preprocessing
should correspond to the figure below:</p>
<p>
 
</p>
<center>
<img align="bottom" width="100%" height="100%" src="https://gitlab.com/jbferet/myshareddata/-/raw/master/PROGYSAT/04_FIGURES/03_RGB.png">
</center>
<p>
 
</p>
<p>Once S2 acquisition and corresponding cloud mask are downloaded and
written on your disk, you can then run <code>biodivMapR</code> using the
modality of your choice:</p>
<ul>
<li><p>you can run <code>biodivMapR</code> in <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_12.html" class="external-link">standard
mode</a> using directly the raster corresponding to BOA reflectance
data, and applying the original workflow: radiometric filtering -&gt;
spectral transformation &amp; component selection -&gt; spectral species
mapping -&gt; diversity mapping</p></li>
<li><p>you can run <code>biodivMapR</code> in <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_13.html" class="external-link">custom
mode</a> using user-defined custom layers, such as spectral indices,
biophysical variables, or a combination of relevant features derived
from multiple sensors for a customized workflow: [optional radiometric
filtering -&gt; optional spectral transformation &amp; component
selection -&gt; ] spectral species mapping -&gt; diversity mapping.
Then, the selection of the relevant features used to compute remotely
sensed variability is at the user’s discretion.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean-Baptiste Feret, Florian de Boissieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
