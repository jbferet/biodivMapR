<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 spectral indices • biodivMapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 spectral indices">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivMapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.14.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biodivMapR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/biodivMapR_01.html">Prepare your data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_02.html">Set parameters for biodivMapR</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_03.html">Perform spatial &amp; spectral filtering</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_04.html">PCA &amp; Dimensionality reduction</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_05.html">Spectral species mapping</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_06.html">alpha and beta diversity maps</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_07.html">Functional Diversity</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_08.html">How to perform validation?</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_09.html">Compute diversity from user-defined set of layers</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_10.html">Map diversity from Lautaret HS image</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_11.html">PROGYSAT#1: download S2 data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_12.html">PROGYSAT#2: Run biodivMapR on S2 reflectance data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_13.html">PROGYSAT#3: Run biodivMapR on selected spectral indices</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_14.html">COPERNICUS &amp; biodiv #1: set working environment</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_15.html">COPERNICUS &amp; biodiv #2: Get reference data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_16.html">COPERNICUS &amp; biodiv #3: check S2 availability</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_17.html">COPERNICUS &amp; biodiv #4: download</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_18.html">COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 reflectance</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_19.html">COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 spectral indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbferet/biodivMapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>COPERNICUS &amp; biodiv #5/6: Apply biodivMapR
on S2 spectral indices</h1>
                        <h4 data-toc-skip class="author">Jean-Baptiste
Féret</h4>
            
            <h4 data-toc-skip class="date">2025-01-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbferet/biodivMapR/blob/master/vignettes/biodivMapR_19.Rmd" class="external-link"><code>vignettes/biodivMapR_19.Rmd</code></a></small>
      <div class="hidden name"><code>biodivMapR_19.Rmd</code></div>

    </div>

    
    
<p>Ce tutoriel accompagne la suite de la <strong>séquence 6</strong> de
la section <strong>Cartographie de la biodiversité par imagerie
satellite</strong> du module de formation <strong>COPERNICUS et
biodiversité</strong> de la Copernicus Academy.</p>
<p>Il permet d’appliquer biodivMapR à des données issues d’imagerie
Sentinel-2 (précédemment téléchargées et pré-traitées) et définies par
l’utilisateur. Dans le cadre de cette séquence, des indices spectraux
sont d’abord calculés à partir des données Sentinel-2, pour être ensuite
utilises avec biodivMapR.</p>
<div class="section level2">
<h2 id="séquence-6-2-appliquer-biodivmapr-à-une-série-dindices-spectraux-calculés-à-partir-de-données-sentinel-2">Séquence 6.2: Appliquer biodivMapR à une série d’indices spectraux
calculés à partir de données Sentinel-2<a class="anchor" aria-label="anchor" href="#s%C3%A9quence-6-2-appliquer-biodivmapr-%C3%A0-une-s%C3%A9rie-dindices-spectraux-calcul%C3%A9s-%C3%A0-partir-de-donn%C3%A9es-sentinel-2"></a>
</h2>
<p>La principale différence avec le tutoriel precedent est le calcul
préalable d’indices spectraux à partir des données de réflectance
Sentinel-2.</p>
<p>Le package <a href="https://github.com/jbferet/spinR" class="external-link">spinR</a> est
un package permettant de calculer des indices spectraux à partir de
données d’imagerie au format raster.</p>
<div class="section level3">
<h3 id="définition-des-paramètres-necessaires-à-biodivmapr">Définition des paramètres necessaires à <code>biodivMapR</code><a class="anchor" aria-label="anchor" href="#d%C3%A9finition-des-param%C3%A8tres-necessaires-%C3%A0-biodivmapr"></a>
</h3>
<p>Les variables définies lors du <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_17.html" class="external-link">précédent
tutoriel</a> sont rappelées ici.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load biodivMapR &amp; spinR</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jbferet/biodivMapR" class="external-link">biodivMapR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spinR</span><span class="op">)</span></span>
<span><span class="co"># load additional packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="va">Input_Image_File</span> <span class="op">&lt;-</span> <span class="va">Refl_path</span> </span>
<span><span class="va">Input_Mask_File</span> <span class="op">&lt;-</span> <span class="va">cloudmasks</span><span class="op">$</span><span class="va">BinaryMask</span></span>
<span><span class="va">Output_Dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">result_path</span>,<span class="st">'biodivMapR'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TypePCA sets the name for the directory name where to save results. </span></span>
<span><span class="co"># Here, as no spectral transformation (PCA, SPCA, MNF) is applied, user can define any other name</span></span>
<span><span class="va">TypePCA</span> <span class="op">&lt;-</span> <span class="st">'SI'</span></span>
<span><span class="co"># number of clusters (spectral species)</span></span>
<span><span class="va">nbclusters</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="co"># window size: RS diversity will be computed for this window size over the raster</span></span>
<span><span class="va">window_size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># computational parameters</span></span>
<span><span class="va">nbCPU</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">MaxRAM</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="application-dun-filtre-radiométrique">Application d’un filtre radiométrique<a class="anchor" aria-label="anchor" href="#application-dun-filtre-radiom%C3%A9trique"></a>
</h3>
<p>Cette étape permet de réaliser un filtre pour eliminer les pixels
ennuagés, ombragés ou non végétalisés. C’est un filtre assez grossier
car basé sur des règles de décision très simplifiées:</p>
<ul>
<li><p>le seuillage du NDVI permet d’éliminer les pixels non
végétalisés.</p></li>
<li><p>le seuillage dans le domaine visible correspondant au bleu permet
d’éliminer les pixels présentant une réflectance particulièrement forte
pour de la végétation, laissant supposer la présence de brumes ou de
nuages non identifiés par le masque nuage produit par la méthode de
correction atmosphérique.</p></li>
<li><p>le seuillage dans le domaine proche infrarouge permet d’éliminer
les pixels présentant une réflectance particulièrement faible pour de la
végétation, laissant supposer que le pixel est situé à l’ombre.</p></li>
</ul>
<p>A l’issue de cette étape, le masque défini par
<code>Input_Mask_File</code> est mis à jour.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define levels for radiometric filtering</span></span>
<span><span class="va">NDVI_Thresh</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">Blue_Thresh</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">NIR_Thresh</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span>
<span><span class="va">Input_Mask_File</span> <span class="op">&lt;-</span> <span class="fu">biodivMapR</span><span class="fu">::</span><span class="fu"><a href="../reference/perform_radiometric_filtering.html">perform_radiometric_filtering</a></span><span class="op">(</span>Image_Path <span class="op">=</span> <span class="va">Input_Image_File</span>,</span>
<span>                                                             Mask_Path <span class="op">=</span> <span class="va">Input_Mask_File</span>,</span>
<span>                                                             Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>,</span>
<span>                                                             TypePCA <span class="op">=</span> <span class="va">TypePCA</span>,</span>
<span>                                                             NDVI_Thresh <span class="op">=</span> <span class="va">NDVI_Thresh</span>,</span>
<span>                                                             Blue_Thresh <span class="op">=</span> <span class="va">Blue_Thresh</span>,</span>
<span>                                                             NIR_Thresh <span class="op">=</span> <span class="va">NIR_Thresh</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calcul-des-indices-spectraux">Calcul des indices spectraux<a class="anchor" aria-label="anchor" href="#calcul-des-indices-spectraux"></a>
</h3>
<p>Cette partie fait appel au package spinR pour produire les indices
spectraux. Un crtain nombre d’indices spectraux est déja implementé.
L’utilisateur peut aussi utiliser un interpreteur permettant de calculer
un indice qui ne serait pas implementé.</p>
<p>Ici, nous sélectionnons trois indices spectraux:</p>
<ul>
<li>le <a href="https://www.indexdatabase.de/db/i-single.php?id=224" class="external-link">Canopy
Chlorophyll Content Index</a> (CCCI)</li>
<li>le Continuum removed Shortwave infrared index (CR_SWIR)</li>
<li>le LAI_SAVI</li>
</ul>
<p>Le CCCI est supposé être sensible à la teneur en chlorophylle de la
végétation. Le CR_SWIR est supposé être sensible à la teneur en eau de
la végétation. Le LAI est supposé être sensible au Leaf Area Index.</p>
<p>La robustesse de ces relations entre indices spectraux et propriétés
de végétation n’est pas l’objet de ce tutoriel. L’objectif ici est de
permettre à l’utilisateur de sélectionner des variables préalablement
dérivées de données de télédetection, jugées pertinentes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get spectral bands corresponding to S2 image</span></span>
<span><span class="va">HDR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ENVI_header.html">read_ENVI_header</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_HDR_name.html">get_HDR_name</a></span><span class="op">(</span><span class="va">Input_Image_File</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SensorBands</span> <span class="op">&lt;-</span> <span class="va">HDR</span><span class="op">$</span><span class="va">wavelength</span></span>
<span><span class="co"># get raster stack from Input_Image_File</span></span>
<span><span class="va">Refl</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">Input_Image_File</span><span class="op">)</span></span>
<span><span class="co"># Define a list of spectral indices</span></span>
<span><span class="va">Sel_Indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CCCI'</span>,<span class="st">'CR_SWIR'</span>,<span class="st">'LAI_SAVI'</span><span class="op">)</span></span>
<span><span class="co"># then compute the spectral indices from raster data, using spectral bands as </span></span>
<span><span class="co"># close as possible from Sentinel-2 spectral bands used for the spectral indices</span></span>
<span><span class="va">Spectral_Indices</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">compute_S2SI_Raster</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">Refl</span>, </span>
<span>                                               SensorBands <span class="op">=</span> <span class="va">SensorBands</span>, </span>
<span>                                               Sel_Indices <span class="op">=</span> <span class="va">Sel_Indices</span>, </span>
<span>                                               StackOut <span class="op">=</span> <span class="cn">T</span>, </span>
<span>                                               ReflFactor <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<p>Une fois les indices spectraux calculés, un masque peut être mis a
jour afin d’éliminer les pixels correspondant à des outliers. De plus,
les indices spectraux doivent être écrits sur le disque sous la forme
d’un stack correspondant au meme format que le stack produit lorsqu’une
transformation spectrale est appliquée.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># initial mask values</span></span>
<span><span class="va">Mask</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">Input_Mask_File</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span><span class="op">[</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="co"># remove outliers from spectral indices</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">idx</span> <span class="kw">in</span> <span class="va">Sel_Indices</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">rast</span> <span class="op">&lt;-</span> <span class="va">Spectral_Indices</span><span class="op">$</span><span class="va">SpectralIndices</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">IQRminmax</span> <span class="op">&lt;-</span> <span class="fu">biodivMapR</span><span class="fu">::</span><span class="fu"><a href="../reference/IQR_outliers.html">IQR_outliers</a></span><span class="op">(</span>DistVal <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">rast</span><span class="op">)</span>,weightIRQ <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span><span class="op">[</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">rast</span><span class="op">)</span><span class="op">&lt;</span><span class="va">IQRminmax</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">|</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">rast</span><span class="op">)</span><span class="op">&gt;</span><span class="va">IQRminmax</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># apply mask on stack</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Spectral_Indices</span><span class="op">$</span><span class="va">SpectralIndices</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Spectral_Indices</span><span class="op">$</span><span class="va">SpectralIndices</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Spectral_Indices</span><span class="op">$</span><span class="va">SpectralIndices</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">*</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># convert into stars object</span></span>
<span><span class="va">StarsObj</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="va">Spectral_Indices</span><span class="op">$</span><span class="va">SpectralIndices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write SI stack</span></span>
<span><span class="va">SI_Path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">rootdir</span>,<span class="st">'SpectralIndices'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">SI_Path</span>,showWarnings <span class="op">=</span> <span class="cn">F</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">SI_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">SI_Path</span>,<span class="st">'SI_Stack'</span><span class="op">)</span></span>
<span><span class="va">Input_Mask_File_update</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">SI_Path</span>,<span class="st">'SI_Mask'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save mask in raster file</span></span>
<span><span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html" class="external-link">write_stars</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span>, </span>
<span>                   dsn <span class="op">=</span> <span class="va">Input_Mask_File_update</span>, </span>
<span>                   driver <span class="op">=</span>  <span class="st">"ENVI"</span>,</span>
<span>                   type <span class="op">=</span> <span class="st">'Byte'</span><span class="op">)</span></span>
<span><span class="co"># save Stack of spectral indices in raster file with spectral indices defining band names</span></span>
<span><span class="fu">biodivMapR</span><span class="fu">::</span><span class="fu"><a href="../reference/write_StarsStack.html">write_StarsStack</a></span><span class="op">(</span>StarsObj <span class="op">=</span> <span class="va">StarsObj</span>, </span>
<span>                             dsn <span class="op">=</span> <span class="va">SI_file</span>, </span>
<span>                             BandNames <span class="op">=</span> <span class="va">Sel_Indices</span>, </span>
<span>                             datatype<span class="op">=</span><span class="st">'Float32'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="definition-de-la-carte-despeces-spectrales">Definition de la carte d’especes spectrales<a class="anchor" aria-label="anchor" href="#definition-de-la-carte-despeces-spectrales"></a>
</h3>
<p>Une fois les indices spectraux sélectionnés, la carte d’espèces
spectrales peut être calculée. Ces espèces spectrales sont définies à
l’aide d’un algorithme de k-means clustering.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SpectralSpace_Output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'PCA_Files'</span> <span class="op">=</span> <span class="va">SI_file</span>, </span>
<span>                             <span class="st">'TypePCA'</span> <span class="op">=</span> <span class="va">TypePCA</span><span class="op">)</span></span>
<span><span class="va">Kmeans_info</span> <span class="op">&lt;-</span> <span class="fu">biodivMapR</span><span class="fu">::</span><span class="fu"><a href="../reference/map_spectral_species.html">map_spectral_species</a></span><span class="op">(</span>Input_Image_File <span class="op">=</span> <span class="va">Input_Image_File</span>,</span>
<span>                                                Input_Mask_File <span class="op">=</span> <span class="va">Input_Mask_File_update</span>,</span>
<span>                                                Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>,</span>
<span>                                                SpectralSpace_Output <span class="op">=</span> <span class="va">SpectralSpace_Output</span>,</span>
<span>                                                nbclusters <span class="op">=</span> <span class="va">nbclusters</span>,</span>
<span>                                                SelectedPCs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">SI_file</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                                nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, MaxRAM <span class="op">=</span> <span class="va">MaxRAM</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calcul-de-la-diversité-spectrale-alpha">Calcul de la diversité spectrale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#calcul-de-la-diversit%C3%A9-spectrale-alpha"></a>
</h3>
<p>Une carte de diversité
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
(ici correspondant à l’indice de Shannon) peut alors être calculée.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Index_Alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Shannon'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/map_alpha_div.html">map_alpha_div</a></span><span class="op">(</span>Input_Image_File <span class="op">=</span> <span class="va">Input_Image_File</span>, </span>
<span>              Input_Mask_File <span class="op">=</span> <span class="va">Input_Mask_File_update</span>, </span>
<span>              Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>, </span>
<span>              TypePCA <span class="op">=</span> <span class="va">TypePCA</span>,</span>
<span>              window_size <span class="op">=</span> <span class="va">window_size</span>, </span>
<span>              nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, </span>
<span>              MaxRAM <span class="op">=</span> <span class="va">MaxRAM</span>,</span>
<span>              Index_Alpha <span class="op">=</span> <span class="va">Index_Alpha</span>, </span>
<span>              nbclusters <span class="op">=</span> <span class="va">nbclusters</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calcul-de-la-diversité-spectrale-beta">Calcul de la diversité spectrale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#calcul-de-la-diversit%C3%A9-spectrale-beta"></a>
</h3>
<p>De la même manière, une carte de diversité
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
est aussi calculée.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/map_beta_div.html">map_beta_div</a></span><span class="op">(</span>Input_Image_File <span class="op">=</span> <span class="va">Input_Image_File</span>, </span>
<span>             Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>, </span>
<span>             TypePCA <span class="op">=</span> <span class="va">TypePCA</span>,</span>
<span>             window_size <span class="op">=</span> <span class="va">window_size</span>, </span>
<span>             nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, </span>
<span>             MaxRAM <span class="op">=</span> <span class="va">MaxRAM</span>,</span>
<span>             nbclusters <span class="op">=</span> <span class="va">nbclusters</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean-Baptiste Feret, Florian de Boissieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
