<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Map diversity from Lautaret HS image • biodivMapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Map diversity from Lautaret HS image">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivMapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.14.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/biodivMapR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/biodivMapR_01.html">Prepare your data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_02.html">Set parameters for biodivMapR</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_03.html">Perform spatial &amp; spectral filtering</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_04.html">PCA &amp; Dimensionality reduction</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_05.html">Spectral species mapping</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_06.html">alpha and beta diversity maps</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_07.html">Functional Diversity</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_08.html">How to perform validation?</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_09.html">Compute diversity from user-defined set of layers</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_10.html">Map diversity from Lautaret HS image</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_11.html">PROGYSAT#1: download S2 data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_12.html">PROGYSAT#2: Run biodivMapR on S2 reflectance data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_13.html">PROGYSAT#3: Run biodivMapR on selected spectral indices</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_14.html">COPERNICUS &amp; biodiv #1: set working environment</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_15.html">COPERNICUS &amp; biodiv #2: Get reference data</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_16.html">COPERNICUS &amp; biodiv #3: check S2 availability</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_17.html">COPERNICUS &amp; biodiv #4: download</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_18.html">COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 reflectance</a>
    </li>
    <li>
      <a href="../articles/biodivMapR_19.html">COPERNICUS &amp; biodiv #5/6: Apply biodivMapR on S2 spectral indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbferet/biodivMapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Map diversity from Lautaret HS image</h1>
                        <h4 data-toc-skip class="author">Jean-Baptiste
Féret, Florian de Boissieu</h4>
            
            <h4 data-toc-skip class="date">2024-08-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbferet/biodivMapR/blob/master/vignettes/biodivMapR_10.Rmd" class="external-link"><code>vignettes/biodivMapR_10.Rmd</code></a></small>
      <div class="hidden name"><code>biodivMapR_10.Rmd</code></div>

    </div>

    
    
<p>This tutorial illustrates how to run <code>biodivMapR</code> in order
to map spectral diversity based on a set of spectral indices.</p>
<p>The study site (Roche Noire) is a high elevation watershed located
next to the Lautaret pass (France, Hautes Alpes) in the south-western
Alps. <a href="https://fr.wikipedia.org/wiki/Col_du_Lautaret#/maplink/1" class="external-link">N 45°
02′ 07″, E 6° 24′ 20″</a></p>
<p>More information about the study area and data used for this
illustration can be found in <a href="http://dx.doi.org/10.1098/rsbl.2014.0347" class="external-link">Pottier et
al. (2014)</a>.</p>
<div class="section level2">
<h2 id="download-imaging-spectroscopy-data-and-corresponding-ground-plots">Download imaging spectroscopy data and corresponding ground
plots<a class="anchor" aria-label="anchor" href="#download-imaging-spectroscopy-data-and-corresponding-ground-plots"></a>
</h2>
<p>the image is available as a zip archive from a <a href="https://gitlab.com/jbferet/myshareddata/-/raw/master/Lautaret_HSI" class="external-link">gitlab
repository</a>.</p>
<p>The image is an ENVI raster acquired with the dual Airborne Imaging
Spectroradiometer for Applications (AISA; Specim Ltd., Finland) on July
23rd, 2008, including :</p>
<ul>
<li><p>A binary file (which has no extension here).</p></li>
<li><p>A header file (with <strong>.hdr</strong> extension).</p></li>
</ul>
<p>The header file is a text file including all necessary metadata which
can be read with a text editor. It includes image dimensions,
projection, and the name and <strong>central wavelength for each
spectral band</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load biodivMapR and useful libraries </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jbferet/biodivMapR" class="external-link">biodivMapR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">utils</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/zip" class="external-link">zip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tools</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># directory where data will be downloaded</span></span>
<span><span class="va">PathData</span> <span class="op">&lt;-</span> <span class="st">'01_DATA'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">PathData</span>,showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co"># url for the zip file containing imaging spectroscopy data</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">'https://gitlab.com/jbferet/myshareddata/-/raw/master/Lautaret_HSI/ROCHENOIRE_HSI.zip'</span></span>
<span><span class="co"># name zip file including plots located on the tile</span></span>
<span><span class="va">destzip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathData</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># download and unzip data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">destzip</span><span class="op">)</span></span>
<span><span class="va">ImDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathData</span>,<span class="st">'HSI_Lautaret'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">destzip</span>,exdir <span class="op">=</span> <span class="va">ImDir</span><span class="op">)</span></span>
<span><span class="co"># define relative path for image name</span></span>
<span><span class="va">ImName</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">ImDir</span>,pattern <span class="op">=</span> <span class="st">'.hdr'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Input_Image_File</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ImDir</span>,<span class="va">ImName</span><span class="op">)</span></span></code></pre></div>
<p>Once opened in QGIS, the image should look like this:</p>
<p align="center">
<img width="100%" height="100%" src="../reference/figures/10_HSI_Lautaret_Plots.png"></p>
<ul>
<li>
<span style="color:red;background-color:#999999"> <em>FG : open
subalpine grasslands dominated by Festuca violacea, mostly found on
south-facing steep slopes</em> </span>.</li>
<li>
<span style="color:yellow;background-color:#999999"> <em>FP : tall
subalpine grasslands dominated by Patzkea paniculata (syn. Festuca
paniculata), mostly found on south-facing gentle slopes with deep
soil</em> </span>.</li>
<li>
<span style="color:orange;background-color:#999999"> <em>SC :
sparsely vegetated grasslands dominated by Sesleria caerulea on
south-facing, debris-covered slopes</em> </span>.</li>
<li>
<span style="color:blue;background-color:#999999"> <em>V: low
stature heaths dominated by Vaccinium uliginosum and Vaccinium
myrtillus, mostly found on north-facing slopes</em> </span>.</li>
</ul>
<p align="center">
<img width="100%" height="100%" src="../reference/figures/Lautaret/overview_001.jpg"><em>Overview of the site</em>
</p>
<table class="table">
<tr>
<th>
Illustration of FP type
</th>
<th>
Illustration of FP type
</th>
</tr>
<tr>
<td>
<img src="../reference/figures/Lautaret/FP_001.JPG" alt="Drawing" style="width: 100%;">
</td>
<td>
<img src="../reference/figures/Lautaret/FP_002.jpg" alt="Drawing" style="width: 100%;">
</td>
</tr>
<tr>
<th>
Illustration of V type
</th>
<th>
Illustration of V type
</th>
</tr>
<tr>
<td>
<img src="../reference/figures/Lautaret/V_001.JPG" alt="Drawing" style="width: 100%;">
</td>
<td>
<img src="../reference/figures/Lautaret/V_002.jpg" alt="Drawing" style="width: 100%;">
</td>
</tr>
<tr>
<th>
Illustration of FV type
</th>
<th>
Illustration of S type
</th>
</tr>
<tr>
<td>
<img src="../reference/figures/Lautaret/FV_001.JPG" alt="Drawing" style="width: 100%;">
</td>
<td>
<img src="../reference/figures/Lautaret/S_001.JPG" alt="Drawing" style="width: 100%;">
</td>
</tr>
</table>
</div>
<div class="section level2">
<h2 id="compute-spectral-indices-from-imaging-spectroscopy">Compute spectral indices from imaging spectroscopy<a class="anchor" aria-label="anchor" href="#compute-spectral-indices-from-imaging-spectroscopy"></a>
</h2>
<p>The computation of spectral indices can be performed with the package
<code>spinR</code>. Please refer to the <a href="https://gitlab.com/jbferet/spinr" class="external-link">homepage</a> and follow
instructions for installation.</p>
<div class="section level3">
<h3 id="load-additional-libraries-and-prepare-data-for-computation">Load additional libraries and prepare data for computation<a class="anchor" aria-label="anchor" href="#load-additional-libraries-and-prepare-data-for-computation"></a>
</h3>
<p>We will first read the imaging spectroscopy raster with the
<code>raster</code> package. We will also get the central wavelength
corresponding to each spectral band in the file from the <strong>header
file</strong>, which is critical for the automated computation of
spectral indices.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spinR</span><span class="op">)</span> <span class="co"># https://gitlab.com/jbferet/spinr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="va">ImBrick</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="va">Input_Image_File</span><span class="op">)</span></span>
<span><span class="va">HDR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ENVI_header.html">read_ENVI_header</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_HDR_name.html">get_HDR_name</a></span><span class="op">(</span><span class="va">Input_Image_File</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SensorBands</span> <span class="op">&lt;-</span> <span class="va">HDR</span><span class="op">$</span><span class="va">wavelength</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computation-of-spectral-indices">Computation of spectral indices<a class="anchor" aria-label="anchor" href="#computation-of-spectral-indices"></a>
</h3>
<p>We select a set of spectral indices identified as relevant for the
estimation of various vegetation traits.</p>
<p>These spectral indices and the corresponding leaf traits are the
following ones:</p>
<p>** TCARI/OSAVI (<a href="https://doi.org/10.1016/S0034-4257(02)00018-4" class="external-link">Haboudane et
al. (2002)</a>), which is supposed to be related to leaf chlorophyll
content.</p>
<p>** ND_LMA (<a href="https://doi.org/10.1016/j.rse.2008.06.005" class="external-link">le
Maire et al. (2008)</a>), which is supposed to be related to Leaf Mass
per Area (LMA).</p>
<p>** CR_SWIR (Féret, 2020 - unpublished), which is supposed to be
related to Equivalent Water Thickness (EWT).</p>
<p>The NDVI is also computed in order to mask non vegetated pixels based
on a simple tresholding.</p>
<p>Here, we are using the function
<code>ComputeSpectralIndices_fromExpression</code> to compute spectral
indices based on an expression.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ReflFactor</span> <span class="op">&lt;-</span> <span class="fl">10000</span> <span class="co"># using reflectance data coded in Int16 between 0 and 10000</span></span>
<span></span>
<span><span class="co">#############################       NDVI     ###################################</span></span>
<span><span class="co"># 1- Define the expression corresponding to the spectral index</span></span>
<span><span class="va">Expression_NDVI</span> <span class="op">&lt;-</span> <span class="st">'(B2-B1)/(B2+B1)'</span></span>
<span><span class="co"># 2- Define the spectral bands corresponding to bands in the spectral index, </span></span>
<span><span class="co"># identified as BXX, with XX the number of the band</span></span>
<span><span class="va">Bands_NDVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Bands_NDVI</span><span class="op">[[</span><span class="st">'B1'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">665</span></span>
<span><span class="va">Bands_NDVI</span><span class="op">[[</span><span class="st">'B2'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">835</span></span>
<span><span class="co"># 3- Compute the spectral indices</span></span>
<span><span class="va">NDVI</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">compute_SI_fromExp</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                                  SensorBands <span class="op">=</span> <span class="va">SensorBands</span>, </span>
<span>                                  ExpressIndex <span class="op">=</span> <span class="va">Expression_NDVI</span>, </span>
<span>                                  listBands <span class="op">=</span> <span class="va">Bands_NDVI</span>, </span>
<span>                                  ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span>, </span>
<span>                                  NameIndex <span class="op">=</span> <span class="st">'NDVI'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################   TCARI/OSAVI   ##################################</span></span>
<span><span class="co"># _______________                     TCARI                     ________________</span></span>
<span><span class="co"># 1- spectral bands to be used</span></span>
<span><span class="va">Bands_TCARI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Bands_TCARI</span><span class="op">[[</span><span class="st">'B1'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">700</span></span>
<span><span class="va">Bands_TCARI</span><span class="op">[[</span><span class="st">'B2'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">670</span></span>
<span><span class="va">Bands_TCARI</span><span class="op">[[</span><span class="st">'B3'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">550</span></span>
<span><span class="co"># 2- Formula for the index</span></span>
<span><span class="va">Formula_TCARI</span> <span class="op">&lt;-</span> <span class="st">'3*(B1-B2-0.2*(B1-B3)*(B1/B2))'</span></span>
<span><span class="co"># 3- application of spectral index on image</span></span>
<span><span class="va">TCARI</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">compute_SI_fromExp</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                                   SensorBands <span class="op">=</span> <span class="va">SensorBands</span>,</span>
<span>                                   ExpressIndex <span class="op">=</span> <span class="va">Formula_TCARI</span>, </span>
<span>                                   listBands <span class="op">=</span> <span class="va">Bands_TCARI</span>,</span>
<span>                                   ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span>,</span>
<span>                                   NameIndex <span class="op">=</span> <span class="st">'TCARI'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># _______________                     OSAVI                     ________________</span></span>
<span><span class="co"># 1- spectral bands to be used</span></span>
<span><span class="va">Bands_OSAVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Bands_OSAVI</span><span class="op">[[</span><span class="st">'B1'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">800</span></span>
<span><span class="va">Bands_OSAVI</span><span class="op">[[</span><span class="st">'B2'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">700</span></span>
<span><span class="va">Bands_OSAVI</span><span class="op">[[</span><span class="st">'B3'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">670</span></span>
<span><span class="co"># 2- Formula for the index</span></span>
<span><span class="va">Formula_OSAVI</span> <span class="op">&lt;-</span> <span class="st">'1.16*(B1-B3)/(B2+B3-0.16)'</span></span>
<span><span class="co"># 3- application of spectral index on image</span></span>
<span><span class="va">OSAVI</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">compute_SI_fromExp</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                                   SensorBands <span class="op">=</span> <span class="va">SensorBands</span>,</span>
<span>                                   ExpressIndex <span class="op">=</span> <span class="va">Formula_OSAVI</span>, </span>
<span>                                   listBands <span class="op">=</span> <span class="va">Bands_OSAVI</span>,</span>
<span>                                   ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span>,</span>
<span>                                   NameIndex <span class="op">=</span> <span class="st">'OSAVI'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># _______________             Compute TCARI/OSAVI             _________________</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">'computing TCARI/OSAVI'</span><span class="op">)</span></span>
<span><span class="va">TCARI_OSAVI</span> <span class="op">&lt;-</span> <span class="va">TCARI</span><span class="op">/</span><span class="va">OSAVI</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TCARI_OSAVI</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'TCARI_OSAVI'</span></span>
<span></span>
<span><span class="co">#############################       CR_SWIR     ##################################</span></span>
<span><span class="co"># 1- The expression for computation of continuum removal is already coded in spinR</span></span>
<span><span class="co"># 2- Define the spectral bands corresponding to bands in the spectral index</span></span>
<span><span class="va">Bands_CR_SWIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Bands_CR_SWIR</span><span class="op">[[</span><span class="st">'CRmin'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1150</span></span>
<span><span class="va">Bands_CR_SWIR</span><span class="op">[[</span><span class="st">'CRmax'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2200</span></span>
<span><span class="va">Bands_CR_SWIR</span><span class="op">[[</span><span class="st">'target'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1550</span></span>
<span><span class="co"># 3- Compute the spectral indices</span></span>
<span><span class="va">CR_SWIR</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">CR_WL</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                        SensorBands <span class="op">=</span> <span class="va">SensorBands</span>,</span>
<span>                        CRbands <span class="op">=</span> <span class="va">Bands_CR_SWIR</span>, </span>
<span>                        ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span><span class="op">)</span></span>
<span><span class="va">CR_SWIR</span> <span class="op">&lt;-</span> <span class="va">CR_SWIR</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#############################       ND_LMA     ##################################</span></span>
<span><span class="co"># 1- Define the expression corresponding to the spectral index</span></span>
<span><span class="va">Expression_ND_LMA</span> <span class="op">&lt;-</span> <span class="st">'(B2-B1)/(B2+B1)'</span></span>
<span><span class="co"># 2- Define the spectral bands corresponding to bands in the spectral index</span></span>
<span><span class="va">Bands_ND_LMA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Bands_ND_LMA</span><span class="op">[[</span><span class="st">'B1'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1490</span></span>
<span><span class="va">Bands_ND_LMA</span><span class="op">[[</span><span class="st">'B2'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2260</span></span>
<span><span class="co"># 3- Compute the spectral indices</span></span>
<span><span class="va">ND_LMA</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">CR_WL</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                       SensorBands <span class="op">=</span> <span class="va">SensorBands</span>, </span>
<span>                       ExpressIndex <span class="op">=</span> <span class="va">Expression_ND_LMA</span>, </span>
<span>                       listBands <span class="op">=</span> <span class="va">Bands_ND_LMA</span>, </span>
<span>                       ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span>, </span>
<span>                       NameIndex <span class="op">=</span> <span class="st">'ND_LMA'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################       ANCB      ##################################</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">'computing ANCB'</span><span class="op">)</span></span>
<span><span class="va">AUCminmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">AUCminmax</span><span class="op">[[</span><span class="st">'CRmin'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">650</span></span>
<span><span class="va">AUCminmax</span><span class="op">[[</span><span class="st">'CRmax'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">720</span></span>
<span><span class="va">ANCB</span> <span class="op">&lt;-</span> <span class="fu">spinR</span><span class="fu">::</span><span class="fu">AUC</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                   SensorBands <span class="op">=</span> <span class="va">SensorBands</span>, </span>
<span>                   AUCminmax <span class="op">=</span> <span class="va">AUCminmax</span>, </span>
<span>                   ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span><span class="op">)</span></span>
<span><span class="va">AUCminmax</span><span class="op">[[</span><span class="st">'target'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">670</span></span>
<span><span class="va">ANCB</span> <span class="op">&lt;-</span> <span class="va">ANCB</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu">spinR</span><span class="fu">::</span><span class="fu">CR_WL</span><span class="op">(</span>Refl <span class="op">=</span> <span class="va">ImBrick</span>, </span>
<span>                             SensorBands <span class="op">=</span> <span class="va">SensorBands</span>,</span>
<span>                             CRbands <span class="op">=</span> <span class="va">AUCminmax</span>, </span>
<span>                             ReflFactor <span class="op">=</span> <span class="va">ReflFactor</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Once computed, we we perform interquartile analysis on these spectral
indices in order to mask outliers.</p>
<p>Then we write these indices as individual raster files.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Save these spectral indices as raster files</span></span>
<span><span class="va">NameIndices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"TCARI_OSAVI"</span>, <span class="st">"CR_SWIR"</span>, <span class="st">"ND_LMA"</span>, <span class="st">"ANCB"</span><span class="op">)</span></span>
<span><span class="co"># directory where data will be downloaded</span></span>
<span><span class="va">PathOut</span> <span class="op">&lt;-</span> <span class="st">'03_RESULTS'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">PathOut</span>,showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Index_Path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SI</span> <span class="kw">in</span> <span class="va">NameIndices</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># first exclude outliers and Inf values</span></span>
<span>  <span class="va">IQRminmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IQR_outliers.html">IQR_outliers</a></span><span class="op">(</span>DistVal <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span>  <span class="va">SI</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span>  <span class="va">SI</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span>  <span class="va">SI</span><span class="op">)</span>,<span class="st">'&lt;IQRminmax[1] | '</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span>  <span class="va">SI</span><span class="op">)</span>,<span class="st">'&gt;IQRminmax[2]] &lt;- NA'</span>,sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Index_Path</span><span class="op">[[</span><span class="va">SI</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathOut</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'HSI_Lautaret_'</span>,<span class="va">SI</span>,sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html" class="external-link">write_stars</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span>  <span class="va">SI</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, dsn<span class="op">=</span><span class="va">Index_Path</span><span class="op">[[</span><span class="va">SI</span><span class="op">]</span><span class="op">]</span>, driver <span class="op">=</span>  <span class="st">"ENVI"</span>,type<span class="op">=</span><span class="st">'Float32'</span><span class="op">)</span></span>
<span>  <span class="co"># write band name in HDR</span></span>
<span>  <span class="va">HDR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ENVI_header.html">read_ENVI_header</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_HDR_name.html">get_HDR_name</a></span><span class="op">(</span><span class="va">Index_Path</span><span class="op">[[</span><span class="va">SI</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">HDR</span><span class="op">$</span><span class="va">`band names`</span> <span class="op">&lt;-</span> <span class="va">SI</span></span>
<span>  <span class="fu"><a href="../reference/write_ENVI_header.html">write_ENVI_header</a></span><span class="op">(</span>HDR <span class="op">=</span> <span class="va">HDR</span>,HDRpath <span class="op">=</span> <span class="fu"><a href="../reference/get_HDR_name.html">get_HDR_name</a></span><span class="op">(</span><span class="va">Index_Path</span><span class="op">[[</span><span class="va">SI</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The following figure displays a color composition of three
indices:</p>
<ul>
<li><p><span style="color:red"> <em><strong>TCARI/OSAVI</strong></em>
</span>.</p></li>
<li><p><span style="color:green"> <em><strong>CR_SWIR</strong></em>
</span>.</p></li>
<li><p><span style="color:blue"> <em><strong>ANCB</strong></em>
</span>.</p></li>
</ul>
<p align="center">
<img width="100%" height="100%" src="../reference/figures/10_SpectralIndices_Lautaret.png"></p>
</div>
<div class="section level3">
<h3 id="correlation-analysis-of-spectral-indices">Correlation analysis of spectral indices<a class="anchor" aria-label="anchor" href="#correlation-analysis-of-spectral-indices"></a>
</h3>
<p>The correlation between spectral indices can be performed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot" class="external-link">corrplot</a></span><span class="op">)</span></span>
<span><span class="co"># 1- create a data.frame from all spectral indices</span></span>
<span><span class="va">df_Indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'TCARI_OSAVI'</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">TCARI_OSAVI</span><span class="op">)</span>, <span class="st">'CR_SWIR'</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">CR_SWIR</span><span class="op">)</span>, </span>
<span>                         <span class="st">'ND_LMA'</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">ND_LMA</span><span class="op">)</span>, <span class="st">'ANCB'</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">ANCB</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2- create a list of raster objects</span></span>
<span><span class="va">Spectral_Indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Spectral_Indices</span><span class="op">[[</span><span class="st">'TCARI_OSAVI'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">TCARI_OSAVI</span></span>
<span><span class="va">Spectral_Indices</span><span class="op">[[</span><span class="st">'CR_SWIR'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">CR_SWIR</span></span>
<span><span class="va">Spectral_Indices</span><span class="op">[[</span><span class="st">'ND_LMA'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ND_LMA</span></span>
<span><span class="va">Spectral_Indices</span><span class="op">[[</span><span class="st">'ANCB'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ANCB</span></span>
<span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">df_Indices</span>,use <span class="op">=</span> <span class="st">'complete.obs'</span><span class="op">)</span></span>
<span><span class="fu">corrplot</span><span class="op">(</span><span class="va">M</span>, method <span class="op">=</span> <span class="st">'ellipse'</span>, order <span class="op">=</span> <span class="st">'AOE'</span>, type <span class="op">=</span> <span class="st">'upper'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="stacking-and-writing-spectral-indices-in-format-expected-by-biodivmapr">Stacking and writing spectral indices in format expected by
biodivMapR<a class="anchor" aria-label="anchor" href="#stacking-and-writing-spectral-indices-in-format-expected-by-biodivmapr"></a>
</h2>
<p>Once the spectral indices are computed, they will be stacked and
written in <strong>ENVI format with <a href="https://bitbucket.org/hu-geomatics/enmap-box-idl/wiki/Data%20Format%20Definition" target="_blank" class="external-link">BIL interleaves</a></strong>.</p>
<div class="section level3">
<h3 id="mask-data-from-spectral-indices-and-apply-the-mask-on-spectral-indices">Mask data from spectral indices and apply the mask on spectral
indices<a class="anchor" aria-label="anchor" href="#mask-data-from-spectral-indices-and-apply-the-mask-on-spectral-indices"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack spectral indices</span></span>
<span><span class="va">Index_Path</span><span class="op">[[</span><span class="st">'NDVI'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">Mask</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">*</span><span class="va">NDVI</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'Mask'</span></span>
<span><span class="va">StarsObj</span> <span class="op">&lt;-</span> <span class="fu">read_ListRasters</span><span class="op">(</span><span class="va">Index_Path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove outliers from spectral indices</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SI</span> <span class="kw">in</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Spectral_Indices</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">rast</span> <span class="op">&lt;-</span> <span class="va">Spectral_Indices</span><span class="op">[[</span><span class="va">SI</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">IQRminmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IQR_outliers.html">IQR_outliers</a></span><span class="op">(</span>DistVal <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">rast</span><span class="op">)</span>,weightIRQ <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">Mask</span><span class="op">[</span><span class="va">rast</span><span class="op">&lt;</span><span class="va">IQRminmax</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">|</span> <span class="va">rast</span><span class="op">&gt;</span><span class="va">IQRminmax</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rast</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Mask</span><span class="op">[</span><span class="va">NDVI</span><span class="op">&lt;</span><span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="co"># apply mask on stack and convert as stars object</span></span>
<span><span class="va">StarsObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="fu">as</span><span class="op">(</span>object <span class="op">=</span> <span class="va">StarsObj</span>,Class <span class="op">=</span> <span class="st">'Raster'</span><span class="op">)</span><span class="op">*</span><span class="va">Mask</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-mask-file-and-spectral-indices-as-raster-stack">Save Mask file and spectral indices as raster stack<a class="anchor" aria-label="anchor" href="#save-mask-file-and-spectral-indices-as-raster-stack"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save mask in raster file</span></span>
<span><span class="va">Input_Mask_File</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathOut</span>,<span class="st">'Mask'</span><span class="op">)</span></span>
<span><span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html" class="external-link">write_stars</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">)</span>, dsn<span class="op">=</span><span class="va">Input_Mask_File</span>, driver <span class="op">=</span>  <span class="st">"ENVI"</span>,type<span class="op">=</span><span class="st">'Byte'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define path where to store spectral indices (same as root path for biodivMapR output directory)</span></span>
<span><span class="va">NameRaster</span> <span class="op">&lt;-</span> <span class="st">'HSI_Lautaret'</span></span>
<span><span class="va">NameStack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">NameRaster</span>,<span class="st">'_StackIndices'</span>,sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="co"># save Stack of spectral indices in raster file with spectral indices defining band names</span></span>
<span><span class="va">Path_StackIndices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathData</span>,<span class="va">NameStack</span><span class="op">)</span></span>
<span><span class="fu">biodivMapR</span><span class="fu">::</span><span class="fu"><a href="../reference/write_StarsStack.html">write_StarsStack</a></span><span class="op">(</span>StarsObj <span class="op">=</span> <span class="va">StarsObj</span>, </span>
<span>                             dsn <span class="op">=</span> <span class="va">Path_StackIndices</span>, </span>
<span>                             BandNames <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Index_Path</span><span class="op">)</span>, </span>
<span>                             datatype <span class="op">=</span> <span class="st">'Float32'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="run-biodivmapr-on-a-raster-stack">Run biodivMapR on a raster stack<a class="anchor" aria-label="anchor" href="#run-biodivmapr-on-a-raster-stack"></a>
</h2>
<div class="section level3">
<h3 id="set-parameters-for-biodivmapr">Set parameters for biodivMapR<a class="anchor" aria-label="anchor" href="#set-parameters-for-biodivmapr"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see additional information here</span></span>
<span><span class="co"># https://jbferet.github.io/biodivMapR/articles/biodivMapR_02.html</span></span>
<span></span>
<span><span class="co"># Define path for original image file to be processed</span></span>
<span><span class="va">Input_SIstack_File</span> <span class="op">&lt;-</span> <span class="va">Path_StackIndices</span></span>
<span><span class="co"># trick to define the same directory as PathIndices defined in previous chunk</span></span>
<span><span class="va">TypePCA</span> <span class="op">&lt;-</span> <span class="st">'noPCA'</span></span>
<span><span class="co"># Define path for master output directory where files produced during the process are saved </span></span>
<span><span class="va">Output_Dir</span> <span class="op">&lt;-</span> <span class="va">PathOut</span></span>
<span><span class="co"># window size forcomputation of spectral diversity</span></span>
<span><span class="va">window_size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># computational parameters</span></span>
<span><span class="va">nbCPU</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">MaxRAM</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="co"># number of clusters (spectral species)</span></span>
<span><span class="va">nbclusters</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># use 10% of image to sample pixels and partition it in 20 runs of kmeans</span></span>
<span><span class="va">NbPix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Mask</span><span class="op">[</span>,,,<span class="fl">1</span><span class="op">]</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">nb_partitions</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">Pix_Per_Partition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">*</span><span class="va">NbPix</span><span class="op">/</span><span class="va">nb_partitions</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="perform-spectral-species-mapping">Perform Spectral species mapping<a class="anchor" aria-label="anchor" href="#perform-spectral-species-mapping"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># https://jbferet.github.io/biodivMapR/articles/biodivMapR_05.html</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"MAP SPECTRAL SPECIES"</span><span class="op">)</span></span>
<span><span class="co"># select all spectral indices</span></span>
<span><span class="va">SelectedPCs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">Input_SIstack_File</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">SpectralSpace_Output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'PCA_Files'</span> <span class="op">=</span> <span class="va">Input_SIstack_File</span>, </span>
<span>                             <span class="st">'TypePCA'</span> <span class="op">=</span> <span class="va">TypePCA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Kmeans_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_spectral_species.html">map_spectral_species</a></span><span class="op">(</span>Input_Image_File <span class="op">=</span> <span class="va">Input_SIstack_File</span>, </span>
<span>                                    Input_Mask_File <span class="op">=</span> <span class="va">Input_Mask_File</span>,</span>
<span>                                    Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>,</span>
<span>                                    SpectralSpace_Output <span class="op">=</span> <span class="va">SpectralSpace_Output</span>, </span>
<span>                                    nbclusters <span class="op">=</span> <span class="va">nbclusters</span>, </span>
<span>                                    nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, MaxRAM <span class="op">=</span> <span class="va">MaxRAM</span>, </span>
<span>                                    SelectedPCs <span class="op">=</span> <span class="va">SelectedPCs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-diversity-indices">Map diversity indices<a class="anchor" aria-label="anchor" href="#map-diversity-indices"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># https://jbferet.github.io/biodivMapR/articles/biodivMapR_06.html</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"MAP ALPHA DIVERSITY"</span><span class="op">)</span></span>
<span><span class="va">Index_Alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Shannon'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/map_alpha_div.html">map_alpha_div</a></span><span class="op">(</span>Input_Image_File <span class="op">=</span> <span class="va">Input_SIstack_File</span>, </span>
<span>              Input_Mask_File <span class="op">=</span> <span class="va">Input_Mask_File</span>, </span>
<span>              Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>, </span>
<span>              TypePCA <span class="op">=</span> <span class="va">TypePCA</span>,</span>
<span>              window_size <span class="op">=</span> <span class="va">window_size</span>, </span>
<span>              nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, </span>
<span>              MaxRAM <span class="op">=</span> <span class="va">MaxRAM</span>,</span>
<span>              Index_Alpha <span class="op">=</span> <span class="va">Index_Alpha</span>, </span>
<span>              nbclusters <span class="op">=</span> <span class="va">nbclusters</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"MAP BETA DIVERSITY"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/map_beta_div.html">map_beta_div</a></span><span class="op">(</span>Input_Image_File <span class="op">=</span> <span class="va">Input_SIstack_File</span>, </span>
<span>             Output_Dir <span class="op">=</span> <span class="va">Output_Dir</span>, </span>
<span>             TypePCA <span class="op">=</span> <span class="va">TypePCA</span>,</span>
<span>             window_size <span class="op">=</span> <span class="va">window_size</span>, </span>
<span>             nbCPU <span class="op">=</span> <span class="va">nbCPU</span>, </span>
<span>             MaxRAM <span class="op">=</span> <span class="va">MaxRAM</span>,</span>
<span>             nbclusters <span class="op">=</span> <span class="va">nbclusters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print("MAP FUNCTIONAL DIVERSITY")</span></span>
<span><span class="co"># https://jbferet.github.io/biodivMapR/articles/biodivMapR_07.html</span></span>
<span><span class="co"># Villeger et al, 2008 https://doi.org/10.1890/07-1206.1</span></span>
<span><span class="co"># map_functional_div(Original_Image_File = Input_SIstack_File, </span></span>
<span><span class="co">#                    Functional_File = Input_SIstack_File,</span></span>
<span><span class="co">#                    Selected_Features = SelectedPCs, </span></span>
<span><span class="co">#                    Output_Dir = Output_Dir,</span></span>
<span><span class="co">#                    window_size = window_size, </span></span>
<span><span class="co">#                    nbCPU = nbCPU, </span></span>
<span><span class="co">#                    MaxRAM = MaxRAM,</span></span>
<span><span class="co">#                    TypePCA = TypePCA)</span></span></code></pre></div>
<p>The map corresponding to beta-diversity (based on a principal
coordinate analysis applied to Bray Curts dissimilarity matrix) is
displayed hereafter:</p>
<p align="center">
<img width="100%" height="100%" src="../reference/figures/10_Beta_Lautaret.png"></p>
</div>
<div class="section level3">
<h3 id="perform-validation-based-on-a-vectorized-plot-network">Perform validation based on a vectorized plot network<a class="anchor" aria-label="anchor" href="#perform-validation-based-on-a-vectorized-plot-network"></a>
</h3>
<p>First, the zip file containing the shapefile with field plots needs
to be downloaded from the repository and unzipped.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># url for the zip file containing imaging spectroscopy data</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">'https://gitlab.com/jbferet/myshareddata/-/raw/master/Lautaret_HSI/ROCHENOIRE_PLOTS.zip'</span></span>
<span><span class="co"># name zip file including plots located on the tile</span></span>
<span><span class="va">destzip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathData</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># download and unzip data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">destzip</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">destzip</span>,exdir <span class="op">=</span> <span class="va">PathData</span><span class="op">)</span></span>
<span><span class="va">VectorDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">PathData</span>,<span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then the validation can be performed.</p>
<p>The same procedure as in the <a href="https://jbferet.github.io/biodivMapR/articles/biodivMapR_08.html" target="_blank" class="external-link">previous tutorial</a> can be applied.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list vector data</span></span>
<span><span class="va">Path_Vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_shp.html">list_shp</a></span><span class="op">(</span><span class="va">VectorDir</span><span class="op">)</span></span>
<span><span class="va">Name_Vector</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">Path_Vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">NamePlots</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">Path_Vector</span><span class="op">)</span><span class="op">$</span><span class="va">ID</span></span>
<span><span class="co"># location of the spectral species raster needed for validation</span></span>
<span><span class="va">Path_SpectralSpecies</span> <span class="op">&lt;-</span> <span class="va">Kmeans_info</span><span class="op">$</span><span class="va">SpectralSpecies</span></span>
<span><span class="co"># get diversity indicators corresponding to shapefiles (no partitioning of spectral dibversity based on field plots so far...)</span></span>
<span><span class="va">Biodiv_Indicators</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diversity_from_plots.html">diversity_from_plots</a></span><span class="op">(</span>Raster_SpectralSpecies <span class="op">=</span> <span class="va">Path_SpectralSpecies</span>, Plots <span class="op">=</span> <span class="va">Path_Vector</span>, </span>
<span>                                          nbclusters <span class="op">=</span> <span class="va">nbclusters</span>, Raster_Functional <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                          Selected_Features <span class="op">=</span> <span class="va">SelectedPCs</span>, Name_Plot <span class="op">=</span> <span class="va">NamePlots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># identify which plots were in the image</span></span>
<span><span class="va">WhichPlots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Biodiv_Indicators</span><span class="op">$</span><span class="va">Shannon</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">Biodiv_Indicators</span><span class="op">$</span><span class="va">Shannon</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">NamePlot</span> <span class="op">&lt;-</span> <span class="va">Biodiv_Indicators</span><span class="op">$</span><span class="va">Name_Plot</span><span class="op">[</span><span class="va">WhichPlots</span><span class="op">]</span></span>
<span><span class="va">TypeCommunity</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">Path_Vector</span><span class="op">)</span><span class="op">$</span><span class="va">COMM</span><span class="op">[</span><span class="va">WhichPlots</span><span class="op">]</span></span>
<span></span>
<span><span class="va">Richness_RS</span> <span class="op">&lt;-</span> <span class="va">Biodiv_Indicators</span><span class="op">$</span><span class="va">Richness</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">WhichPlots</span><span class="op">]</span></span>
<span><span class="va">Shannon_RS</span> <span class="op">&lt;-</span> <span class="va">Biodiv_Indicators</span><span class="op">$</span><span class="va">Shannon</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">WhichPlots</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># write a table for Shannon index</span></span>
<span><span class="va">Path_Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Output_Dir</span>,<span class="va">NameStack</span>,<span class="va">TypePCA</span>,<span class="st">'VALIDATION'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">Path_Results</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>,recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write a table for all spectral diversity indices corresponding to alpha diversity</span></span>
<span><span class="va">Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'ID_Plot'</span><span class="op">=</span><span class="va">NamePlot</span>, <span class="st">'Species_Richness'</span><span class="op">=</span><span class="va">Richness_RS</span>, <span class="st">'Shannon'</span><span class="op">=</span><span class="va">Shannon_RS</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">Results</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Results</span>,<span class="st">"AlphaDiversity.csv"</span><span class="op">)</span>,</span>
<span>            sep<span class="op">=</span><span class="st">"\t"</span>, dec<span class="op">=</span><span class="st">"."</span>, na<span class="op">=</span><span class="st">" "</span>, row.names <span class="op">=</span> <span class="cn">F</span>, col.names<span class="op">=</span> <span class="cn">T</span>,quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write a table for Bray Curtis dissimilarity</span></span>
<span><span class="va">BC_mean</span> <span class="op">&lt;-</span> <span class="va">Biodiv_Indicators</span><span class="op">$</span><span class="va">BCdiss</span><span class="op">[</span><span class="va">WhichPlots</span>,<span class="va">WhichPlots</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">BC_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">BC_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">NamePlot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">BC_mean</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Results</span>,<span class="st">"BrayCurtis.csv"</span><span class="op">)</span>,</span>
<span>            sep<span class="op">=</span><span class="st">"\t"</span>, dec<span class="op">=</span><span class="st">"."</span>, na<span class="op">=</span><span class="st">" "</span>, row.names <span class="op">=</span> <span class="cn">F</span>, col.names<span class="op">=</span> <span class="cn">T</span>,quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply ordination using PCoA (same as done for map_beta_div)</span></span>
<span><span class="va">MatBCdist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="va">BC_mean</span>, diag <span class="op">=</span> <span class="cn">FALSE</span>, upper <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">BetaPCO</span> <span class="op">&lt;-</span> <span class="fu">labdsv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/labdsv/man/pco.html" class="external-link">pco</a></span><span class="op">(</span><span class="va">MatBCdist</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign a type of vegetation to each plot</span></span>
<span><span class="va">NameCommunity</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TypeCommunity</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create data frame including a selection of alpha diversity metrics and beta diversity expressed as coordinates in the PCoA space</span></span>
<span><span class="va">Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'vgtype'</span><span class="op">=</span><span class="va">TypeCommunity</span>,</span>
<span>                      <span class="st">'pco1'</span><span class="op">=</span> <span class="va">BetaPCO</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="st">'pco2'</span><span class="op">=</span> <span class="va">BetaPCO</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,<span class="st">'pco3'</span> <span class="op">=</span> <span class="va">BetaPCO</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                      <span class="st">'shannon'</span><span class="op">=</span><span class="va">Shannon_RS</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot field data in the PCoA space, with size corresponding to shannon index</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span><span class="fu">ggplot</span> <span class="op">(</span><span class="va">Results</span>, <span class="fu">aes</span> <span class="op">(</span>x<span class="op">=</span><span class="va">pco1</span>, y<span class="op">=</span><span class="va">pco2</span>, color<span class="op">=</span><span class="va">vgtype</span>,size<span class="op">=</span><span class="va">shannon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e6140a"</span>, <span class="st">"#e6d214"</span>, <span class="st">"#e68214"</span>, <span class="st">"#145ae6"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span><span class="fu">ggplot</span> <span class="op">(</span><span class="va">Results</span>, <span class="fu">aes</span> <span class="op">(</span>x<span class="op">=</span><span class="va">pco1</span>, y<span class="op">=</span><span class="va">pco3</span>, color<span class="op">=</span><span class="va">vgtype</span>,size<span class="op">=</span><span class="va">shannon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e6140a"</span>, <span class="st">"#e6d214"</span>, <span class="st">"#e68214"</span>, <span class="st">"#145ae6"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g3</span> <span class="op">&lt;-</span><span class="fu">ggplot</span> <span class="op">(</span><span class="va">Results</span>, <span class="fu">aes</span> <span class="op">(</span>x<span class="op">=</span><span class="va">pco2</span>, y<span class="op">=</span><span class="va">pco3</span>, color<span class="op">=</span><span class="va">vgtype</span>,size<span class="op">=</span><span class="va">shannon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e6140a"</span>, <span class="st">"#e6d214"</span>, <span class="st">"#e68214"</span>, <span class="st">"#145ae6"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#extract legend</span></span>
<span><span class="co">#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs</span></span>
<span><span class="va">get_legend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a.gplot</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">ggplot_gtable</span><span class="op">(</span><span class="fu">ggplot_build</span><span class="op">(</span><span class="va">a.gplot</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">leg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">grobs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">==</span> <span class="st">"guide-box"</span><span class="op">)</span></span>
<span>  <span class="va">legend</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="va">leg</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">legend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu">get_legend</span><span class="op">(</span><span class="va">g3</span><span class="op">)</span></span>
<span><span class="va">gAll</span> <span class="op">&lt;-</span> <span class="fu">grid.arrange</span><span class="op">(</span><span class="fu">arrangeGrob</span><span class="op">(</span><span class="va">g1</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                 <span class="va">g2</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                 <span class="va">g3</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                 nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,<span class="va">legend</span>,nrow<span class="op">=</span><span class="fl">2</span>,heights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Results</span>,<span class="st">'BetaDiversity_PcoA1_vs_PcoA2_vs_PcoA3.png'</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">filename</span>, plot <span class="op">=</span> <span class="va">gAll</span>, device <span class="op">=</span> <span class="st">'png'</span>, path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       scale <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">7</span>, units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>       dpi <span class="op">=</span> <span class="fl">600</span>, limitsize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># plot field data in the PCoA space, with size corresponding to shannon index</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Results</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">pco1</span>, y<span class="op">=</span><span class="va">pco2</span>, color<span class="op">=</span><span class="va">vgtype</span>,size<span class="op">=</span><span class="va">shannon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e6140a"</span>, <span class="st">"#e6d214"</span>, <span class="st">"#e68214"</span>, <span class="st">"#145ae6"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">filename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Results</span>,<span class="st">'BetaDiversity_PcoA1_vs_PcoA2.png'</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">filename</span>, plot <span class="op">=</span> <span class="fu">last_plot</span><span class="op">(</span><span class="op">)</span>, device <span class="op">=</span> <span class="st">'png'</span>, path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       scale <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>       dpi <span class="op">=</span> <span class="fl">600</span>, limitsize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Results</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">pco1</span>, y<span class="op">=</span><span class="va">pco3</span>, color<span class="op">=</span><span class="va">vgtype</span>,size<span class="op">=</span><span class="va">shannon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e6140a"</span>, <span class="st">"#e6d214"</span>, <span class="st">"#e68214"</span>, <span class="st">"#145ae6"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">filename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Results</span>,<span class="st">'BetaDiversity_PcoA1_vs_PcoA3.png'</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">filename</span>, plot <span class="op">=</span> <span class="fu">last_plot</span><span class="op">(</span><span class="op">)</span>, device <span class="op">=</span> <span class="st">'png'</span>, path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       scale <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>       dpi <span class="op">=</span> <span class="fl">600</span>, limitsize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Results</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">pco2</span>, y<span class="op">=</span><span class="va">pco3</span>, color<span class="op">=</span><span class="va">vgtype</span>,size<span class="op">=</span><span class="va">shannon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e6140a"</span>, <span class="st">"#e6d214"</span>, <span class="st">"#e68214"</span>, <span class="st">"#145ae6"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">filename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path_Results</span>,<span class="st">'BetaDiversity_PcoA2_vs_PcoA3.png'</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">filename</span>, plot <span class="op">=</span> <span class="fu">last_plot</span><span class="op">(</span><span class="op">)</span>, device <span class="op">=</span> <span class="st">'png'</span>, path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       scale <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>       dpi <span class="op">=</span> <span class="fl">600</span>, limitsize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The resulting figures are displayed below.</p>
<p align="center">
<img width="100%" height="100%" src="../reference/figures/10_Lautaret_BetaDiversity_PcoA1_vs_PcoA2_vs_PcoA3.png"></p>
<p>This data acquisition was initiated and supported by the European <a href="https://cordis.europa.eu/project/id/36866" class="external-link">ECOCHANGE project</a>
(GOCE-CT-2007-036866) and the Swiss National Science Foundation (<a href="https://p3.snf.ch/Project-125145" class="external-link">BIOASSEMBLE</a>,
31003A-125145).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean-Baptiste Feret, Florian de Boissieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
